---
output:
  md_document:
    variant: markdown_github
---
# Goal 

- what is the performance of dividend portfolios. 

- interested in regional performance of indexes that are constrcuted either through HY or DG growth as signals

- the next chunk achieves and now dividend portfolios are proxies for their jurisdiction. 

- include how divident portfolios have diffrent constituents. 
- how those operate in diffrent market cycles. 
```{r}
# loadings
pacman::p_load("xts", "tidyverse", "tbl2xts", "PerformanceAnalytics", 
               "lubridate", "glue", "zoo")

df<- readxl::read_xlsx("data/MAD .xlsx")

#  change the column names for ease of analysis

geographical_codenames <- c("UK_HY", "EM_HY", "UK", "EM", "UK_HY_B", "UK_B", "JP_HY", "EU", "US_HY", "US", "W_HY", "W", "EU_DG", "EU_2", "JP_DG", "US_DG", "US_2", "JP", "SA_DG", "SA", "SA_HY", "EU_HY", "W_HY", "W")

colnames(df)[2:23] <- geographical_codenames

```

# Goal and Steps to Acheive them

- Look at aggregate return effects across regions. 
- Stratify by interest rate and market volatility.
- Assess return consistency. 
- and get an idea of risk attributes of constituents - maybe drawdowns could be a tool that we could employ. 

# But first, lets describe what constitutes these indexes

- we need to classify by style what the index offers. There are value, these are stock that trade below their perceived intrinsic value. 

- Next, we consider high yield and growth in dividends per share as our value signals. Why? The indexes we investigate are return oriented factor based strategies, that dividend yield can be either absolute value or growth. 

- HY, are companies that have a history of paying high dividends per share or have dividend yield . if we hold the payout ratio constant, that yield is a function of earnings yield. To achieve that HY status, its either earnings are high or price is low. They are typically in industries such as telecoms and utilities, and REITS (real estate assets) have cash flows that are more steady and predictable, which enables them to distribute a larger dividend. These businesses typically have better-developed business models and depend less on expansion to produce returns. These companies carry high risk of financial distress, because of being part of a value trap. 

- DG, are companies that have experienced, significant grow its dividend distribution. In other words, have seen their dividend yield ratio go up with time. This could be a function of either, the payout ratio, or earnings yield or both.
Companies in this category typically have higher-quality, cash-rich operations that perform well in both up and down markets and can provide excess returns throughout a complete market cycle. There are less likely to experience losses when interest rates are rising.

- in a nutshell, companines that display the ability to increase their dividend overtime are considered to be much safer, because there have good cash management practices but lack of investmnet opportunities. whereas, high dividend payers, that are more vumnerable to financial distress can be catergorized as the more risky companies. 

The next table just shows each index and its benchmark, for ease of analysis later.

- The data used is from 20-09-03 to 20-09-23, 20 years because that is the maximum we could retrive for all indexes on Bloomberg. 

```{r}
library(kableExtra)
indexes <- readxl::read_xlsx("data/Index Description.xlsx")

kable(indexes)
```


We want to investigate the performance of dividend paying portfolios across different regions. Firstly we will asess the performance of dividend portfolios over market cycles and interest rate regimes.   dynamic performance measures and risk analysis of these portfolios. in essence, why do these portfolios work or not and when they seem to add value to a portfolio. We also high the distinction in growth versus HY performance. 

So, Return, Risk and a combination of the two (IR) will guide the analysis. 

# Objective

Literature has shown that they provide greater excess return over time versus the s&p because the dividend component over and above the capital gains. We expand this to other indices, FTSE, MSCI and try to pick up overall value proposition of dividend indices. 

- So its risk and return that we need to evaluate, so do they provide that excess return over time that is significantly better than its parent index. 

- If they do what are the drivers, we note the construction of the indexes by the different providers. 
are they exposed to higher risk assets. lets mention the composition of different sectors in the index. are some sectors prone to paying higher dividend than others and what is the relationship between return and dividend paynig stock. 

- if they do provide more return do they give more risk. what measure of risk can we give to illustrate this and how do these indexes cover against these risks of the value trap. What other measures of risk will be important to measure over time for these portfolios in the various regions. Mentioning the correlations to market is important 

- finally we consider south African portfolios, are they able to consistently give a return. Lets use the sharpe ratios to determine the consistency of the portfolios. 

##  Compounding Returns, Aggregate effects of Portfolios

- calculate excess returns as the monthly difference return for index and benchmark, then geometrically chain the excess return to compute the cumulative excess returns. 

- correct for differing inception dates. The indices across regions have different inception dates therefore not purely comparable across regions. To correct for this we start the series will start from the first date for all indices and standardized to 1, ie all indices start from the same point. However these indices are not purely comparable, inceptions date may lead to differing momentum effects.

With that caveat, lets start the analysis.


```{r echo=TRUE, message=FALSE, warning=FALSE}
source("code/EXCESSRETURN.R")
library(glue)
library(stats)

#   calculate simple returns just simple excess returns
a <- df %>% My_excess_return(., "UK_HY", "UK") 
b <- df %>% My_excess_return(., "UK_HY_B", "UK_B")

c <- df %>% My_excess_return(., "US_HY", "US")
d <- df %>% My_excess_return(., "US_DG", "US_2")

e <- df %>% My_excess_return(., "EU_HY", "EU")
f <- df %>% My_excess_return(., "EU_DG", "EU_2")

g <- df %>% My_excess_return(., "JP_HY", "JP")
h <- df %>% My_excess_return(., "JP_DG", "JP")

i <- df %>% My_excess_return(., "EM_HY", "EM")

j <- df %>% My_excess_return(., "SA_HY", "SA")
k <- df %>% My_excess_return(., "SA_DG", "SA")

l <- df %>% My_excess_return(., "W_HY", "W")


# Table to describe excess returns


excess_return_df <- list( a, b, c, d, e,f,g,h,i,j,k, l) %>%
  reduce(inner_join, by='date')

table_df <- excess_return_df %>% 
  gather(Regions, Cumulative_Excess_Return, -date) %>% 
  group_by(Regions) %>% 
  summarise("Start Date" = first(date) , "Total Years"  = round( n()/12,0),  Median = median(Cumulative_Excess_Return),  "Cumulative Excess Return" = last(Cumulative_Excess_Return))

table_df

```
- notice that growth portfolios dont add value, SA offers similar to HY and DG. Whats the reason?

- HY did good in most advanced market economies. Gving more than 1X in excess cumulatively, the best being UK assets high yeild. EM not so well on a cumulative basis


## Stratification 

- to get a more nuanced picture of the performance over time, but first 

- some settings - top percentile is 95th and bottom is 5 percentile. 



```{r echo=TRUE, message=FALSE, warning=FALSE}
#   get the vol data and get some dates

 vol_data <- readxl::read_xlsx("data/volatility for indexes.xlsx") %>% gather(index, px , -Date) %>% 
  mutate(ret = px/lag(px)-1, RollSD = RcppRoll::roll_sd(1 + ret, 12, fill = NA, align = "right") * 
             sqrt(12)) %>% 
    filter(!is.na(RollSD))
```


```{r echo=TRUE, message=FALSE, warning=FALSE}
# # get the top quartile and bottom quartile
 strat_df <- vol_data %>% filter(index == "VIX") %>%  mutate(topQ = quantile(RollSD, probs = 0.95), 
               botQ = quantile(RollSD, probs = 0.05),
               Strat = ifelse(RollSD >= topQ, "HiVol", 
                           ifelse(RollSD <= botQ, "LowVol", "Normal_Vol")))
 
# # US strat
 
 hivol_per_vector_us <- strat_df %>% filter(Strat %in% "HiVol") %>% pull(Date)
 lovol_per_vector_us <- strat_df %>% filter(Strat %in% "LowVol") %>% pull(Date)

 # UK 

 strat_df <-vol_data %>% filter(index == "IVIUK") %>% mutate(topQ = quantile(RollSD, probs = 0.95), 
               botQ = quantile(RollSD, probs = 0.05),
              Strat = ifelse(RollSD >= topQ, "HiVol", 
                          ifelse(RollSD <= botQ, "LowVol", "Normal_Vol")))
# 
 hivol_per_vector_uk  <- strat_df %>% filter(Strat %in% "HiVol") %>% pull(Date)
 lovol_per_vector_uk  <- strat_df %>% filter(Strat %in% "LowVol") %>% pull(Date)
#  EU 
 
 strat_df <-vol_data %>% filter(index == "V2X") %>% mutate(topQ = quantile(RollSD, probs = 0.95), 
               botQ = quantile(RollSD, probs = 0.05),
              Strat = ifelse(RollSD >= topQ, "HiVol", 
                          ifelse(RollSD <= botQ, "LowVol", "Normal_Vol")))
# 
 hivol_per_vector_eu  <- strat_df %>% filter(Strat %in% "HiVol") %>% pull(Date)
 lovol_per_vector_eu  <- strat_df %>% filter(Strat %in% "LowVol") %>% pull(Date) 
# # SA 

 strat_df <-vol_data %>% filter(index == "SAVIT40") %>% mutate(topQ = quantile(RollSD, probs = 0.95), 
               botQ = quantile(RollSD, probs = 0.05),
               Strat = ifelse(RollSD >= topQ, "HiVol", 
                           ifelse(RollSD <= botQ, "LowVol", "Normal_Vol")))
# 
 hivol_per_vector_sa <- strat_df %>% filter(Strat %in% "HiVol") %>% pull(Date)
 lovol_per_vector_sa <- strat_df %>% filter(Strat %in% "LowVol") %>% pull(Date)

#  High Vol df 
 
source("code/Stratifier.R")
  
stratifying_df <-  bind_rows(
 stratifier(df, "EU_HY", "EU", hivol_per_vector_eu, "High Vol" ),
 stratifier(df, "EU_DG", "EU_2", hivol_per_vector_eu, "High Vol" ),
 stratifier(df, "UK_HY", "UK", hivol_per_vector_eu, "High Vol" ),
 stratifier(df, "UK_HY_B", "UK", hivol_per_vector_eu, "High Vol"),
 stratifier(df, "JP_HY", "JP", hivol_per_vector_us, "High Vol"),
 stratifier(df, "JP_DG", "JP", hivol_per_vector_us, "High Vol"),
 stratifier(df, "EM_HY", "EM", hivol_per_vector_us, "High Vol"),
 stratifier(df, "SA_HY", "SA", hivol_per_vector_sa, "High Vol"),
 stratifier(df, "SA_DG", "SA", hivol_per_vector_sa, "High Vol"),
 stratifier(df, "US_HY", "US", hivol_per_vector_us, "High Vol"), 
 stratifier(df, "US_DG", "US", hivol_per_vector_us, "High Vol"), 
 stratifier(df , "W_HY", "W", hivol_per_vector_us, "High Vol"), 
 stratifier(df, "EU_HY", "EU", lovol_per_vector_eu, "Low Vol Period" ),
 stratifier(df, "EU_DG", "EU_2", lovol_per_vector_eu, "Low Vol Period" ),
 stratifier(df, "UK_HY", "UK", lovol_per_vector_eu, "Low Vol Period" ),
 stratifier(df, "UK_HY_B", "UK", lovol_per_vector_eu, "Low Vol Period" ),
 stratifier(df, "JP_HY", "JP", lovol_per_vector_us, "Low Vol Period" ),
 stratifier(df, "JP_DG", "JP", lovol_per_vector_us, "Low Vol Period" ),
 stratifier(df, "EM_HY", "EM", lovol_per_vector_us, "Low Vol Period" ),
 stratifier(df, "SA_HY", "SA", lovol_per_vector_sa, "Low Vol Period" ),
 stratifier(df, "SA_DG", "SA", lovol_per_vector_sa, "Low Vol Period" ),
 stratifier(df, "US_HY", "US", lovol_per_vector_us, "Low Vol Period" ), 
 stratifier(df, "US_DG", "US", lovol_per_vector_us, "Low Vol Period" ), 
 stratifier(df, "W_HY", "W", lovol_per_vector_us, "Low Vol Period")
 )

stratifying_df %>% arrange(Name)
```
- not entirely confident with my methodology  and I need help on this. 
- after stratification i simple calc returns similar to having the full sample of dates. I knowledge that this may lead suspicious results not be enough data points to string good representation of returns
- but general trends for HY indexes.  EM HY > Low Vol. EU_HY> Hi Vol.  JP_HY > Low Vol. SA_HY >High Vol. UK_HY (Both) Low Vol. US _HY > Low vol and W_HY > Low Vol. 
- and DG . EU_DG > Low vol . JP> High Vol. SA > HI Vol, US > Low_Vol

 Within regions SA_HY(H), UK_HY_B(L), US_DG(L), EM_HY(L), EU_HY(L), JP_HY(L). So this simply means that for our different portfolios, HY performs well and mostly in low volatile periods. Linking that back to our definition for HY index assets it is rationale that most of the value stock that are vulnerable to financial distress would find favor from investors in a very risky environment (Low volatility). 

# Interest rate cycles

Given a series of central bank interest rates. I want to get dates of n consecutive interest rate changes. 

To do this I will

- create a column that conditions if there was a rate change or nt.
- apply a rolling function that counts a desired number of consistent hikes or cuts or neutral/hold period.
- similar to the vol, aggregate performance in those dates. 

```{r}
rate_data <- readxl::read_xlsx("data/Policy Rates.xlsx") 

names <- c("Date", "US", "UK", "JP", "ECB", "SA")

colnames(rate_data) <- names

US_rates <- rate_data %>% select(Date, US)
UK_rates <- rate_data %>% select(Date, UK)
JP_rates <- rate_data %>% select(Date, JP)
SA_rates <- rate_data %>% select(Date, SA)
ECB_rates <- rate_data %>% select(Date, ECB)
# Get Rates for the US
source("code/Interest_Regime.R")


#  rename the columns for the function to work

Regime_df <- Regime_change_df(US_rates, "US", 5)
Hiking_date_vector_us <- Regime_df %>% filter(regime %in% "Hiking") %>% pull(Date)
Cutting_date_vector_us <- Regime_df %>% filter(regime %in% "Cutting") %>% pull(Date)
Neutral_date_vector_us <- Regime_df %>% filter(regime %in% "Neutral") %>% pull(Date) 

Regime_df <- Regime_change_df(UK_rates, "UK", 5)
Hiking_date_vector_uk <- Regime_df %>% filter(regime %in% "Hiking") %>% pull(Date)
Cutting_date_vector_uk <- Regime_df %>% filter(regime %in% "Cutting") %>% pull(Date)
Neutral_date_vector_uk <- Regime_df %>% filter(regime %in% "Neutral") %>% pull(Date) 

Regime_df <- Regime_change_df(JP_rates, "JP", 5)
Hiking_date_vector_jp <- Regime_df %>% filter(regime %in% "Hiking") %>% pull(Date)
Cutting_date_vector_jp <- Regime_df %>% filter(regime %in% "Cutting") %>% pull(Date)
Neutral_date_vector_jp <- Regime_df %>% filter(regime %in% "Neutral") %>% pull(Date) 

Regime_df <- Regime_change_df(SA_rates, "SA", 5)
Hiking_date_vector_sa <- Regime_df %>% filter(regime %in% "Hiking") %>% pull(Date)
Cutting_date_vector_sa <- Regime_df %>% filter(regime %in% "Cutting") %>% pull(Date)
Neutral_date_vector_sa <- Regime_df %>% filter(regime %in% "Neutral") %>% pull(Date) 

Regime_df <- Regime_change_df(ECB_rates, "ECB", 5)
Hiking_date_vector_eu <- Regime_df %>% filter(regime %in% "Hiking") %>% pull(Date)
Cutting_date_vector_eu <- Regime_df %>% filter(regime %in% "Cutting") %>% pull(Date)
Neutral_date_vector_eu <- Regime_df %>% filter(regime %in% "Neutral") %>% pull(Date) 
# Hiking Performance

Hiking_performance <-  bind_rows(
 stratifier(df, "EU_HY", "EU", Hiking_date_vector_eu, "Hiking" ),
 stratifier(df, "EU_DG", "EU_2", Hiking_date_vector_eu, "Hiking" ),
 stratifier(df, "UK_HY", "UK", Hiking_date_vector_uk, "Hiking" ),
 stratifier(df, "UK_HY_B", "UK", Hiking_date_vector_uk, "Hiking" ),
 stratifier(df, "EM_HY", "EM", Hiking_date_vector_us, "Hiking"),
 stratifier(df, "SA_HY", "SA", Hiking_date_vector_sa, "Hiking" ),
 stratifier(df, "SA_DG", "SA", Hiking_date_vector_sa, "Hiking" ),
 stratifier(df, "US_HY", "US", Hiking_date_vector_us, "Hiking" ), 
 stratifier(df, "US_DG", "US", Hiking_date_vector_us, "Hiking" )
 )

#  Cutting Perfromance

Cutting_performance <-  bind_rows(
 stratifier(df, "EU_HY", "EU", Cutting_date_vector_eu, "Cut" ),
 stratifier(df, "EU_DG", "EU_2", Cutting_date_vector_eu, "Cut" ),
 stratifier(df, "UK_HY", "UK", Cutting_date_vector_uk, "Cut" ),
 stratifier(df, "UK_HY_B", "UK", Cutting_date_vector_uk, "Cut" ),
 stratifier(df, "EM_HY", "EM", Cutting_date_vector_us, "Cut"),
 stratifier(df, "SA_HY", "SA", Cutting_date_vector_sa, "Cut" ),
 stratifier(df, "SA_DG", "SA", Cutting_date_vector_sa, "Cut" ),
 stratifier(df, "US_HY", "US", Cutting_date_vector_us, "Cut" ), 
 stratifier(df, "US_DG", "US", Cutting_date_vector_us, "Cut" )
 )

# Nuetral 

Nuetral_perfromance <-  bind_rows(
 stratifier(df, "EU_HY", "EU", Neutral_date_vector_eu, "Neutral" ),
 stratifier(df, "EU_DG", "EU_2", Neutral_date_vector_eu, "Neutral" ),
 stratifier(df, "UK_HY", "UK", Neutral_date_vector_uk, "Neutral" ),
 stratifier(df, "UK_HY_B", "UK", Neutral_date_vector_uk, "Neutral" ),
 stratifier(df, "JP_HY", "JP", Neutral_date_vector_jp, "Neutral" ),
 stratifier(df, "JP_DG", "JP", Neutral_date_vector_jp, "Neutral" ),
 stratifier(df, "EM_HY", "EM", Neutral_date_vector_us, "Neutral"),
 stratifier(df, "SA_HY", "SA", Neutral_date_vector_sa, "Neutral" ),
 stratifier(df, "SA_DG", "SA", Neutral_date_vector_sa, "Neutral" ),
 stratifier(df, "US_HY", "US", Neutral_date_vector_us, "Neutral" ), 
 stratifier(df, "US_DG", "US", Neutral_date_vector_us, "Neutral" )
 )

CB_df <- bind_rows(Nuetral_perfromance, 
 Cutting_performance, Hiking_performance) %>% arrange(Name)

CB_df %>% rename(Quarters = "Days") %>% arrange(desc("Annualized Return"))

#  need to aggregate that into a single number 
```
- confident with this stratification
- huge idiosyncratic factors that have influenced the results thus performance of equity within each region. We will not get into that for now. 
- for HY returns, EM  H>C>N. EU N>C>H, SA H>C>N, UK H>C>N , US C>H>N
- for DG returns, US H>C>N, SA H>C>N,  EU N>C>H
- so HY indexes generally perform well in rising interest rate environments and have the lowest return in Neutral interest rate environments and DG dividend growth strategies follow a similar pattern. 
- Similar to the market cycle stratification, some regimes have less data points than other which may affect the returns. 

Within geographies then, EM - HY (H), EU - DG (C), JP - HY (N) , SA-DG (H) , UK HY - B  (H), US_DG (H), So mostly perform well in Hiking periods but their strategies are evenly split given our sample. However there is no clear relationship between which strategy works best.  This contradicts what some pundits advocate, they believe that  investors looking for yield in low rate environments would cause the price action to favor such stock (we have only seen this in the EU DG ), thus give higher returns. 


# Rolling consistency

- How much bang for buck do these strategies give and how consistent are there at acheiving said return

To do this we will first 

- calculate the returns for both benchmark and index and get the tracking error of the each index to its benchmark.
- then simply on a rolling basis depict the movement of each pair. 
- we then graph that. 


```{r}
#  source 

source("code/InformationRatioRoll.R")

a <-  df %>% Information_Ratio_Roll(., "EU_HY", "EU", 20030808, 36)
b <-  df %>% Information_Ratio_Roll(., "EU_DG", "EU_2",20030808, 36)
 c <- df %>% Information_Ratio_Roll(., "UK_HY", "UK", 20030808, 36)
 d <- df %>% Information_Ratio_Roll(., "UK_HY_B", "UK", 20030808, 36)
 e <- df %>% Information_Ratio_Roll(., "JP_HY", "JP", 20030808, 36)
 f <- df %>% Information_Ratio_Roll(., "JP_DG", "JP", 20030808, 36)
 g <- df %>% Information_Ratio_Roll(., "EM_HY", "EM", 20030808, 36)
 h <- df %>% Information_Ratio_Roll(., "SA_HY", "SA", 20030808, 36)
 i <- df %>% Information_Ratio_Roll(., "SA_DG", "SA", 20030808, 36)
 j <- df %>% Information_Ratio_Roll(., "US_HY", "US", 20030808, 36)
 k <- df %>% Information_Ratio_Roll(., "US_DG", "US_2", 20030808, 36)

consistency_df <- list(a, b, c, d, e,f,g,h,i,j,k) %>%
  reduce(inner_join, by='date') %>% 
  gather(IR , ret, -date) 
 
plot <- consistency_df %>%   ggplot() + 
geom_line(aes(date, ret), color = "steelblue", size = 1.1, alpha = 0.8) +
geom_hline(yintercept = 0, color = "red", size = 0.3, alpha = 0.5)+
fmxdat::theme_fmx() + 
facet_wrap(~IR) + 
labs(x = "", y = "Information Ratio", title = "Performance Consistency", subtitle = "Deeply Inconcsistent", caption = "Source:Bloomberg and\n Authors Calculations")

plot

```
- we notive choppy IR for the different indexes across regions. 
- difficult for strategies to consistently deliver IR above zero across varying volatiliy and interest rate regimes. 
- but having said that, lets consider the redline to be a measure of strategy working or not.
- The UK_HY stands out as one that has struggled to give that bang for buck effect. 
- EM  and JP HY and JP DG from 2005 to 2015 return positive IR then since then until the start of 2022 its been negative. 
- SA indexes , a tale of two have shown 2010 to 2020 in positive for DG but the SA HY IR from 2017 to date for HY
- US indexes have been mirroring each other. However difficult to conclude. 

We notice that UK HY portfolios have not been working. Whilst SA HY has deliverd some respectable consistency for several years. However EM _HY  like the UK since 2015 has delivered negative information ratio. Are there common risk factors that give opposite effects?
#  Drawdowns

Drawdowns give a more detailed picture of the risk attributes of the constituents of a data series. Their importance for our study is to uncover latent relationship between performance and drawdown.

```{r}
# lets get cumulative returns for our dividend strategies and Max drawdowns

cum_df <- excess_return_df %>% 
  gather(Funds, ret, -date) %>% mutate(Year = format(date, "%Y")) %>% group_by(Year, Funds) %>% summarize(DD = (max(ret) - min(ret))/max(ret)* 100, Range = range(ret)) %>% arrange(desc(Range)) 

 order <- cum_df %>% pull(Funds) %>% unique()

cum_df$Year <- as.Date(paste0(cum_df$Year, "-01-01"))

source("code/order.R")

plot <- cum_df %>% 
  plot_order(., Column = "Funds", Order = order) %>% 
  ggplot() +
  geom_line(aes(Year, DD), color = "steelblue", size = 1.1, alpha = 0.8) + 
fmxdat::theme_fmx() + 
facet_wrap(~Funds) +
labs(x = "", y = " Max Drawdowns (%)", title = "Yearly Drawdowns", subtitle = "", caption = "Source:Bloomberg and\n Authors Calculations")

plot
```
Draw downs in this study are defined as the difference between low and high values of cumulative excess returns within a time period. From our dividend portfolios we notice that drawdowns are similar in regions and across strategies. 

- Both indexes in SA have shown decreasing levels in drawdowns.  
- US, Japan, EM have shown some level of increasing drawdowns. 
- EU most stable. Low levels


# Putting it together


Over time, dividend portfolios, whether HY or DGPS, have exhibited positive excess returns as indicated by cumulative returns. While the UK_HY index has shown the highest cumulative return, this trend is not consistently observed across other regional indexes. Consequently, when assessing the aggregate perspective on investor portfolio value, dividend portfolios may not offer a reliable means to capture the value premium consistently. However, upon stratifying these portfolios according to different periods of market volatility, it becomes evident that during low volatility periods, the primary determinant of performance is not the geographical region but rather the specific investment strategy employed. In this case, HY strategies.  Surprisingly, portfolios based in South Africa (SA) tend to perform well during these high volatility periods, which is somewhat unconventional as such times are typically associated with a flight to safety, and Emerging Markets (EM) and, by extension, South Africa, are considered riskier.

When extending our analysis to encompass interest rate cycles, we observe a contrasting effect compared to the volatility-based stratification. We find that all strategies appear to give the highest return in hiking cycles. 

In assessing consistency, we employ the information ratio. Initially, we discern that, at a broad level, dividend portfolios do not consistently maintain a positive ratio over an extended investment horizon. However, disparities in performance emerge. Notably, South African (SA) and dividend indexes have consistently delivered positive ratios over the past decade. In contrast, Emerging Markets (EM) and Japanese (JP) indexes have experienced substantial declines in their information ratios, despite seemingly consistent performance prior to 2015. Meanwhile, the United States (US), European Union (EU), and United Kingdom (UK) indexes have exhibited unpredictable performance over the sampled period.

When we integrate our information ratio findings with drawdown analysis, we observe that advanced economies have experienced the fewest drawdowns over the sample period, with the exception of the UK. This could suggest a relatively lower level of systematic risk in these economies. Conversely, South African (SA) and Emerging Market (EM) drawdowns have exhibited a declining trend, possibly indicating a reduced perception of risk in emerging markets over time.

# In a nutshell,

- HY divi strategies work in low volatility.
- All seem to perform well in hiking cycles, but mostly HY portfolios. 
- SA and EM indexes at different periods gave the highest informatio ratio. We know from our cumulative returns that this could be only due to lower risk. Once we look at drawdowns, they reduced overtime. A more direct measure can help explain this point better. 


# Any similarities in this portfolios 

- for this we use our excess returns. 
- do a PCA. 
- and analyze
```{r}
# lets put some more meat on this bone, lets see if by total variation there is a research why portfolios perfrom the way in which they do. 

excess_return <- function(df, index, benchmark) {
  df <- df %>%
    arrange(Date) %>%
    rename(I = {{index}}, B = {{benchmark}}) %>%
    select(Date, I, B) %>%
    mutate(excess = I - B) %>%
    mutate(YM = format(Date, "%y %m")) %>%
    group_by(YM) %>%
    mutate(ret = excess/lag(excess)-1) %>% 
    filter(Date == last(Date)) %>%
    rename(Excess = ret) %>% 
    ungroup %>% 
    select(Date, Excess )
  
 df <- df %>%  rename(!!sym(glue::glue("{index}")) := Excess)
 
 df
}

excess_return(df , "SA_DG", "SA") 

#   calculate simple returns just simple excess returns
a <- df %>% excess_return(., "UK_HY", "UK") 
b <- df %>% excess_return(., "UK_HY_B", "UK_B")

c <- df %>% excess_return(., "US_HY", "US")
d <- df %>% excess_return(., "US_DG", "US_2")

e <- df %>% excess_return(., "EU_HY", "EU")
f <- df %>% excess_return(., "EU_DG", "EU_2")

g <- df %>% excess_return(., "JP_HY", "JP")
h <- df %>% excess_return(., "JP_DG", "JP")

i <- df %>% excess_return(., "EM_HY", "EM")

j <- df %>% excess_return(., "SA_HY", "SA")
k <- df %>% excess_return(., "SA_DG", "SA")

l <- df %>% excess_return(., "W_HY", "W")


# Table to describe excess returns


excess_return_df <- list( a, b, c, d, e,f,g,h,i,j,k, l) %>%
  reduce(inner_join, by='Date') %>% gather(Regions, Return, -Date)

excess_return_df <- excess_return_df %>% mutate(Return = ifelse(Return > 0.30, 0.30, 
    ifelse(Return < -0.30, -0.30,Return)))

excess_return_df %>% ggplot()+ 
  geom_line(aes(Date, Return))

# PCA time 

source("code/impute.R")
data_wide <-  excess_return_df %>%rename(date = Date) %>%  spread(., Regions, Return) %>% impute_missing_returns(.,"Drawn_Distribution_Collective") %>% select(-date)

pca <- prcomp(data_wide)
# We have already cebtered our data, but we could also use
# these built in measures: prcomp(data_wide, center = TRUE,
# scale. = TRUE)

#  get the standard deviations 
pca$sdev
# now the eigen values 

eigenvalues <- pca$sdev^2

#  now for the rotation 

pca$rotation

#  you can use things such as summary just to get more out of the results
summary(pca)

#  installation
if (!require(FactoMineR)) install.packages("FactoMineR")
if (!require(factoextra)) install.packages("factoextra")

# this needs a tibble that has row names 

data <- excess_return_df %>% tibble::rownames_to_column() %>% 
    tibble::as_tibble() %>% column_to_rownames("rowname") %>% select(-Date)

#  lets use our data 
index.pca <- FactoMineR::PCA(data_wide)

factoextra::fviz_pca_var(index.pca, col.var = c("cos2", "contrib", "coord", 
    "x", "y")[1]) + scale_color_gradient2(low = "white", mid = "blue", 
    high = "red", midpoint = 0.5) + theme_minimal()

#  with similar analyses to 

index.pca$var$contrib

# how much of the variationin the PCA is due to the variable

factoextra::fviz_pca_var(index.pca, col.var = "contrib") + scale_color_gradient2(low = "green", 
    mid = "yellow", high = "red", midpoint = 9) + theme_minimal()

#  this should add some text to the graph but scrutenize it later

# factoextra::fviz_pca_biplot(index.pca, geom = "text")

# lets get a new data frame just to get more information out if this 


```

- the second dimension is where the laodings are different, JP_HY is the odd beast, in the first dimension. 
- first dimension loadings are quiet strong for advanced economies and positive for all indicies expect for JP_HY. 
- second dimension there is disparity emerges, advanced economies have a negative loading to the second PC. 
- the question now becomes, whats the composition of US companies in the World MSCI index. 
- in reducing the dimensions of our data, we notice that most economies are affected relative to each other in similar capacity to PCA. 
- excess returns of divi strategies, after reducing dimensions we notice that US strategies have a negative loading to the second PCA. 

# So how has that loading changed overtime and is it significant

- we can then use fundamental analysis to reach that conclusion. 



# The next queston 

now that we have estbalished why they do work, is it factual.

- lets apply a PCA to determine this.
- get soe regressions and commnet. 
- do some clustering. 
- 
