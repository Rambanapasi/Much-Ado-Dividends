---
output:
  md_document:
    variant: markdown_github
---

# Objective

The goal is to assess the performance of dividend yield as an investment strategy. I plan to optimize portfolios of the highest paying dividend stock and/or highest growth in dividends for a group of assets.

- First calculate the excess returns for indices and their benchmarks
- Explain relationships within the return series for each region with and without stratifying the sample. 
- Then maybe look to build own dividend portfolios to see how that would have performed.

# Instruments 

To investigate the performance of dividend paying strategies, either dividend yield or dividend growth I will consider globally traded indices and their benchmarks. For concreteness, I will look at those prescribed in literature. From this I will find the excess return. 

```{r Instruments, echo=FALSE, message=FALSE, warning=FALSE}
library(knitr)
Table_data <- readxl::read_xlsx("data/Instruments from MAD.xlsx")
knitr::kable(Table_data) 
```

##  Excess Return

I calculate excess returns as the monthly difference return for index and benchmark, then calculate cumulative returns for the result. 

The indices across regions have different inception dates therefore not purely comparable across regions. 

From the figure below, results of dividend strategies (High Yield or Dividend Growth) all over the world have been consistently returned  a positive excess over the market index, even though sometimes volatile.  

- consider the mix between high dividend yield versus dividend growth portfolios, so color coordinate the different strategies?

```{r echo=FALSE, message=FALSE, warning=FALSE}
# loadings 
pacman::p_load("xts", "tidyverse", "tbl2xts", "PerformanceAnalytics", 
               "lubridate", "glue")
library(tbl2xts)
library(tidyverse)
library(xts)
source("code/EXCESSRETURN.R")
source("code/EXCESSRETURN2.R")
library(quantmod)

df <- readxl::read_xlsx("data/MAD .xlsx") 

# get all permutatation 
A <- df %>% MY_excess_return(.,"FUDP", "TUKXG") 
B <- df %>% MY_excess_return(., "M2EFDY", "GDUEEGF") 
C <- df %>% MY_excess_return(., "M2EUGDY", "GDDUE15X") 
D <- df %>% MY_excess_return(., "M2GBDY", "GDDUUK") 
E <- df %>% MY_excess_return(., "M2JPDY", "TJDIVD") 
F1 <- df %>% MY_excess_return(., "M2USADVD", "GDDUUS") 
G <- df %>% MY_excess_return(., "M2WDHDVD", "GDDUWI") 
H <- df %>% MY_excess_return(., "SPDAEET", "SPTR350E") 
I <- df %>% MY_excess_return(., "SPDAUDT", "SPXT") 
J <- df %>% MY_excess_return(., "SPJXDAJT", "TPXDDVD") 
K <- df %>% MY_excess_return(., "SPSADAZT", "JALSH") 
L <- df %>% MY_excess_return(., "TJDIVD", "JALSH")

joined_df <- bind_cols(A, B, C, D, E, F1, G, H, I, J, K, L) 

compare <- joined_df %>% select(date...1, FUDP, M2EFDY, M2EUGDY, M2GBDY, M2JPDY, M2USADVD, M2WDHDVD, SPDAEET, SPDAUDT, SPJXDAJT, SPSADAZT, TJDIVD) %>% gather(Index , Return , -date...1)

plot <- compare %>% ggplot(aes(x = date...1, y = Return)) +
  geom_line() +
  labs(x = "Date", y = "Return") +
  theme_minimal() +
  facet_wrap(~ Index, scales = "free_y", ncol = 4)

plot
```
## Stratification 


```{r}
# retrieve from yahoo
vix <- getSymbols("VIX")

# Turn to tibble 
VIX <- VIX %>%
  tbl2xts::xts_tbl(.)
  
VIX <- VIX %>% select(date, VIX.Close) %>% 
  rename(., close = VIX.Close)
# get rolling volatilty 

RollSD <- VIX %>%  arrange(date) %>%
  mutate(YM = format(date, "%Y-%b")) %>% 
  group_by(YM) %>% 
  mutate(ret = log(close)- lag(log(close))) %>% 
  mutate(ret = coalesce(ret, 0)) %>% 
  mutate(RollSD = RcppRoll::roll_sd(1+ret, 12, fill = NA, align = "right") * 
           sqrt(12)) %>% 
  ungroup() %>% 
  filter(!is.na(RollSD)) %>% 
  select(date, RollSD)
# label and pull dates 
strat_df <- 
  RollSD %>% mutate(topQ = quantile(RollSD, probs = 0.8), 
                botQ = quantile(RollSD, probs = 0.2),
                Strat = ifelse(RollSD >= topQ, "HiVol", 
                               ifelse(RollSD <= botQ, "LowVol", "Normal_Vol")))
#  lets pull dates for the high vol period
hivol_per_vector <- strat_df %>% filter(Strat %in% "HiVol") %>% pull(date)

# use dates to get returns for indexes and benchamrks, I will use the comparison dataframe, that has excess returns to do a crude analysis on excess returns during these periods 

df %>% filter(Date %in% hivol_per_vector) %>% MY_excess_return(.,"FUDP", "TUKXG") 


A <- df %>%filter(Date %in% hivol_per_vector) %>%  MY_excess_return(.,"FUDP", "TUKXG") 
B <- df %>%filter(Date %in% hivol_per_vector) %>%  MY_excess_return(., "M2EFDY", "GDUEEGF") 
C <- df %>% filter(Date %in% hivol_per_vector) %>% MY_excess_return(., "M2EUGDY", "GDDUE15X") 
D <- df %>%filter(Date %in% hivol_per_vector) %>%  MY_excess_return(., "M2GBDY", "GDDUUK") 
E <- df %>%filter(Date %in% hivol_per_vector) %>%  MY_excess_return(., "M2JPDY", "TJDIVD") 
F1 <- df %>%filter(Date %in% hivol_per_vector) %>%  MY_excess_return(., "M2USADVD", "GDDUUS") 
G <- df %>% filter(Date %in% hivol_per_vector) %>% MY_excess_return(., "M2WDHDVD", "GDDUWI") 
H <- df %>% filter(Date %in% hivol_per_vector) %>% MY_excess_return(., "SPDAEET", "SPTR350E") 
I <- df %>%filter(Date %in% hivol_per_vector) %>%  MY_excess_return(., "SPDAUDT", "SPXT") 
J <- df %>%filter(Date %in% hivol_per_vector) %>%  MY_excess_return(., "SPJXDAJT", "TPXDDVD") 
K <- df %>%filter(Date %in% hivol_per_vector) %>%  MY_excess_return(., "SPSADAZT", "JALSH") 
L <- df %>%filter(Date %in% hivol_per_vector) %>%  MY_excess_return(., "TJDIVD", "JALSH")
  
joined_df <- bind_cols(A, B, C, D, E, F1, G, H, I, J, K, L) 

compare <- joined_df %>% select(date...1, FUDP, M2EFDY, M2EUGDY, M2GBDY, M2JPDY, M2USADVD, M2WDHDVD, SPDAEET, SPDAUDT, SPJXDAJT, SPSADAZT, TJDIVD) %>% gather(Index , Return , -date...1)

g <- compare %>% ggplot(., aes(x = date...1, y = Return)) +
geom_line() +
labs(x = "Date", y = "Return") +
theme_minimal() +
facet_wrap(~ Index, scales = "free_y", ncol = 4)

g
```


