---
output:
  md_document:
    variant: markdown_github
---

# Roadmap

The goal is to assess the performance of dividend yield as an investment strategy. I plan to use optimized portfolios of the highest paying dividend stock and/or highest growth in dividends for a group of assets. However, first I want to calculate all cumulative returns for all indexes and their benchmarks. 

##  Approach to Use

Passive equity investment offers transparent, investable and a rules-based approach, avoiding the need to identify mispriced securities commonly associated with active portfolio construction. Before we build our own portfolios I will compare performance indexes against their benchmarks across the globally.

I will present this in tabular form showing a comparison between index and benchmark. 

After this I will build global dividend portfolios by sector and assess whether there performance offers superior excess return over the generic geographical option that we often see practitioners construct. 

# Instruments 

```{r Instruments}
library(knitr)
Table_data <- readxl::read_xlsx("data/Systematic Indices and Benchmarks.xlsx")
knitr::kable(Table_data) 
```

# Portfolios  

```{r Cumulative Return}
pacman::p_load("xts", "tidyverse", "tbl2xts", "PerformanceAnalytics", 
               "lubridate", "glue")
library(tbl2xts)
library(tidyverse)
library(xts)


data <- readxl::read_xlsx("data/Benckmarks.xlsx")

#  Mutate_at replaces all the previous columns
d1 <- 
  data %>% 
  arrange(Date) %>% 
  mutate_at(.vars = vars(-Date), ~log(.)-log(lag(.)))

# Just to make some things much simplier
d2 <- data %>% 
  gather(Index, Value, -Date) %>% 
  mutate(Return = Value/lag(Value)-1) %>% 
  ungroup()


#  Lets get log returns using the dplyr, no long format just yet

Year_Month <- function(x) format(as.Date(x), "%Y_%B") 

#  Now to do this using the tidy mannaer 

d2 <- data %>% 
  arrange(Date) %>% 
  mutate(YM = Year_Month(Date)) %>% 
  gather(index, value, -Date) %>% 
  group_by(index) 

#  Just converting it to be numeric

d2$value <- as.numeric(d2$value)

#  These are just the normal componded returns
compounded_returns <- d2 %>%
  mutate(YM = Year_Month(Date)) %>% 
  mutate(dailyReturn = value/lag(value) - 1) %>% 
  filter(Date >= lubridate::ymd(20130128)) %>% 
  # coalesce returns NULL or NA 
  mutate(daliyReturn = coalesce(dailyReturn, 0)) %>% 
  mutate(dailyIndex = cumprod(1 + dailyReturn)) %>% 
  group_by(YM) %>% 
  filter(Date == last(Date)) %>% 
  group_by(index) %>% 
  mutate(MonthlyReturn = dailyIndex/lag(dailyIndex) - 1) %>% 
  select(Date, index, dailyIndex)

compounded_returns %>% tbl_xts(., cols_to_xts = dailyIndex, spread_by = index)

compounded_returns %>%
  ggplot(aes(Date, dailyIndex, color = index, group = index)) +
  geom_line()
  # facet_wrap(~ index) +
  # theme(legend.position = "none")


```

