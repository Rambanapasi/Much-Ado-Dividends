---
# IMPORTANT: Change settings here, but DO NOT change the spacing.
# Remove comments and add values where applicable.
# The descriptions below should be self-explanatory

title: " Much Ado About Dividends"
subtitle: ""

documentclass: "elsarticle"

# --------- Thesis title (Optional - set to FALSE by default).
# You can move the details below around as you please.
Thesis_FP: FALSE
# Entry1: "An unbelievable study with a title spanning multiple lines."
# Entry2: "\\textbf{Some Guy}" # textbf for bold
# Entry3: "A thesis submitted toward the degree of Doctor of Philosophy"
Uni_Logo: Tex/Logo.png # Place a logo in the indicated location (from your root, e.g. defaults to ~/Tex/Logo.png) and uncomment this line. Leave uncommented for no image
# Logo_width: 0.3 # If using a logo - use this to set width (size) of image
Entry4: "Under the supervision of: \\vfill Nico Katzke"
Entry5: "Stellenbosch University"
Entry6: "October 2023"
# Entry7:
# Entry8:

# --------- Front Page
# Comment: ----- Follow this pattern for up to 5 authors
AddTitle: TRUE # Use FALSE when submitting to peer reviewed platform. This will remove author names.
Author1: "Gabriel Rambanapasi"  # First Author - note the thanks message displayed as an italic footnote of first page.
Ref1: "Stellenbosch University, Cape Town, South Africa" # First Author's Affiliation
Email1: "gabriel.rams44\\@gmail.com" # First Author's Email address

Author2: "Nico Katzke"
Ref2: "Satrix, Cape Town, South Africa"
Email2: ""
# CommonAffiliation_12: TRUE # If Author 1 and 2 have a common affiliation. Works with _13, _23, etc.

# Author3: "John Doe"
# Email3: "Joe\\@gmail.com"

CorrespAuthor_1: TRUE  # If corresponding author is author 3, e.g., use CorrespAuthor_3: TRUE

# Comment out below to remove both. JEL Codes only given if keywords also given.
keywords: "" # Use \\sep to separate
JELCodes: ""

# ----- Manage headers and footers:
#BottomLFooter: $Title$
#BottomCFooter:
#TopLHeader: \leftmark # Adds section name at topleft. Remove comment to add it.
BottomRFooter: "\\footnotesize Page \\thepage" # Add a '#' before this line to remove footer.
addtoprule: TRUE
addfootrule: TRUE               # Use if footers added. Add '#' to remove line.

# --------- page margins:
margin: 2.3 # Sides
bottom: 2 # bottom
top: 2.5 # Top
HardSet_layout: TRUE # Hard-set the spacing of words in your document. This will stop LaTeX squashing text to fit on pages, e.g.
# This is done by hard-setting the spacing dimensions. Set to FALSE if you want LaTeX to optimize this for your paper.

# --------- Line numbers
linenumbers: FALSE # Used when submitting to journal

# ---------- References settings:
# You can download cls format here: https://www.zotero.org/ - simply search for your institution. You can also edit and save cls formats here: https://editor.citationstyles.org/about/
# Hit download, store it in Tex/ folder, and change reference below - easy.
bibliography: Tex/ref.bib       # Do not edit: Keep this naming convention and location.
csl: Tex/harvard-stellenbosch-university.csl # referencing format used.
# By default, the bibliography only displays the cited references. If you want to change this, you can comment out one of the following:
# nocite: '@*' # Add all items in bibliography, whether cited or not
 # nocite: |  # add specific references that aren't cited
# @grinold2000
#  @Someoneelse2010

# ---------- General:
RemovePreprintSubmittedTo: TRUE  # Removes the 'preprint submitted to...' at bottom of titlepage
Journal: "Journal of Finance"   # Journal that the paper will be submitting to, if RemovePreprintSubmittedTo is set to TRUE.
toc: FALSE                       # Add a table of contents
numbersections: TRUE             # Should sections (and thus figures and tables) be numbered?
fontsize: 11pt                  # Set fontsize
linestretch: 1.0                # Set distance between lines.
link-citations: TRUE            # This creates dynamic links to the papers in reference list.

### Adding additional latex packages:
# header-includes:
#    - \usepackage{colortbl} # Add additional packages here.

output:
  pdf_document:
    keep_tex: TRUE
    template: Tex/TexDefault.txt
    fig_width: 3.5 # Adjust default figure sizes. This can also be done in the chunks of the text.
    fig_height: 3.5
abstract: |
 This paper investigates dividends return predictive signals, focusing on Dividend Yield (DY) and Dividend Growth (DG) signals, within both domestic and international contexts. Over an extended investment horizon, dividend portfolios consistently exhibit positive excess returns, with notable variations across regional indexes. Notably, these portfolios demonstrate capital protection during periods of heightened market volatility, particularly the DY strategies. Surprisingly, South African portfolios perform well during market turbulence, a departure from the typical flight to safety. In contrast, during interest rate cycles, all strategies perform optimally in low-interest-rate environments. Information ratio analysis highlights that dividend strategies do not uniformly maintain positive ratios, with varying performance patterns across different regions. When integrated with drawdown analysis, advanced economies exhibit lower systematic risk, while South African and Emerging Market drawdowns suggest reduced systematic risk in these markets. Within the South African context, dividend portfolios display potential value during high volatility and rising interest rate cycles, though P/E-based portfolios outperform them in other scenarios. Consequently, dividend portfolios may not be an ideal proxy for value. Investors with specific preferences may still find value in these strategies, but for those constrained by investment policy statements, DG portfolios offer practical, lower-volatility alternatives to achieve returns akin to the market index. This study contributes insights into dividend portfolio dynamics, enabling investors to make informed choices based on their objectives and constraints.
---
<!-- First: Set your default preferences for chunk options: -->

<!-- If you want a chunk's code to be printed, set echo = TRUE. message = FALSE stops R printing ugly package loading details in your final paper too. I also suggest setting warning = FALSE and checking for warnings in R, else you might find ugly warnings in your paper. -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.width = 6, fig.height = 5, fig.pos="H", fig.pos = 'H')
# Note: Include = FALSE implies the code is executed, but not printed in your pdf.
# warning and message = FALSE implies ugly messages and warnings are removed from your pdf.
# These should be picked up when you execute the command chunks (code sections below) in your rmd, not printed in your paper!

# Lets load in example data, and see how this can be stored and later called from your 'data' folder.
if(!require("tidyverse")) install.packages("tidyverse")
library(gt)
library(tidyverse)
library(huxtable)
library(kableExtra)
library(xtable)
library(fmxdat)
pacman::p_load("TTR")
pacman::p_load("tidyr", "tbl2xts","devtools","lubridate", "readr", "PerformanceAnalytics", "ggplot2", "dplyr")
source("code/EXCESSRETURN.R")
source("code/Theme.R")

# loadings
pacman::p_load("xts", "tidyverse", "tbl2xts", "PerformanceAnalytics", 
               "lubridate", "glue", "zoo")

df<- readxl::read_xlsx("data/MAD .xlsx")

#  change the column names for ease of analysis

geographical_codenames <- c("UK_HY", "EM_HY", "UK", "EM", "UK_HY_B", "UK_B", "JP_HY", "EU", "US_HY", "US", "W_HY", "W", "EU_DG", "EU_2", "JP_DG", "US_DG", "US_2", "JP", "SA_DG", "SA", "SA_HY", "EU_HY", "W_HY", "W")

# always working with those indexes
colnames(df)[2:23] <- geographical_codenames

?PerformanceAnalytics::Return.cumulative()
```

<!-- ############################## -->
<!-- # Start Writing here: -->
<!-- ############################## -->
# Introduction {-}

This paper aims to investigate the return predictive signal of dividend-paying stocks. The value of dividends to shareholders has long been a subject of debate among academics and practitioners, with evidence both for their relevance and irrelevance. @miller proposed the dividend irrelevance theorem, which argues that dividend payments are irrelevant because they do not affect shareholder wealth, as it is the income a firm generates that impacts wealth, not the way the firm distributes that income. In contrast, @gordon1962 argued that investors should prefer cash flows because they are certain, as opposed to the riskier capital gains. According to this theory, the "Bird in Hand Theorem" is used to justify the demand for dividend stocks, especially for less risk-tolerant investors. Moreover, a closer examination of the @miller theory reveals unrealistic assumptions, rendering arguments immaterial once real-world constraints, such as taxes, transaction costs, and behavioral biases, are considered. Consequently, theories that consider information asymmetries, tax considerations, and signaling provide convincing arguments for the relevance of dividend payments in addressing real-world considerations. Campbell (2017) posits that the value of a stock is a function of its future cash flow. If markets are assumed to be efficient, then companies that do not pay dividends should have a value of zero unless there is an expectation of future receipts from the investment in said company. Therefore, we can safely assume a direct relationship between share price and new information that affects future cash flows. Event studies on various types of dividend payments address this, and it is often noted that the payment of dividends leads to a decrease in stock prices and thus stock valuation. Suwanna (2012) demonstrates that dividend announcements decrease share prices by the value of the dividend. This could be because dividends are a capital budgeting decision, and their payment reduces retained earnings, consequently affecting the share price.

This study provides an extensive investigation into the return signaling of dividend portfolios. Firstly, it reviews existing literature on dividend payments, their rationale, and the theories both for and against their relevance. Secondly, it outlines our methodology for constructing dividend portfolios, which includes our utility optimizer and associated constraints. Thirdly, the study discusses the results by addressing the first question: When do dividend signals work? To answer this, we initially examine the cumulative excess returns offered by global dividend indexes to provide a comprehensive overview of the performance of geographical dividend portfolios. Our analysis shows that dividend portfolios, whether high yield (HY) or dividend growth (DG), do not consistently provide a clear signal for returns. However, when we stratify our sample according to interest rate cycles (Hiking, Cutting, and Neutral) and market regimes (High and Low Volatility), unique to each geographical region, we begin to find that within specific market regimes, dividend signals exhibit defensive characteristics and offer higher excess returns during periods of High Volatility. This, however, does not guarantee positive returns for all indexes, as our proxies for the United States (US) HY, UK HY, and World indexes returned negative results over their respective periods.

Regarding performance consistency, when examining the rolling information ratio, we observe an inherent lack of consistency in dividend portfolio performance, with most strategies underperforming the benchmark over the past 15 years. Nevertheless, coupled with drawdowns experienced in different jurisdictions, we acknowledge that advanced market dividend portfolios experience the least variation in drawdowns compared to emerging markets. The results indicate that both growth and high-yield dividend portfolios tend to underperform relative to their benchmarks, raising questions about their ability to extract a value premium.

Lastly, the paper delves into how dividend portfolios work with the goal of constructing a portfolio that can best harness the existing premium. We utilize share data from the Johannesburg Stock Exchange (JSE), with our benchmark being the Capped SWIX Top 50. We construct four portfolios using 3-month and 9-month measures of HY, 1 and 3-year DG measures, together with price momentum and dividend coverage ratios. Similar to the analysis of international dividend portfolios, our portfolios exhibit defensive properties in high-volatility periods but fail to consistently capture a premium over investing in a market index.

# Dividend Payments{-}

Dividends represent a form of capital redistribution that are transferred through either cash or stock dividends by a company to its shareholders. Depending on either cash or stock dividend their impact to equity and/or cash accounts is recorded differently thus having different effects on company valuation. To understand, consider the fundamental law of valuation that describes equity value as a function of assets and liabilities of a company.  For a stock dividends, a company distributions additional shares to its shareholders, typically these are paid relative to outstanding shares traded on the market. For instance, a 5 percent stock dividends declared by company means an investor with 100 shares would receive an additional shares in the company. On the balance,  the resulting effect are that  retained earnings (asset) are decreased and conversely shareholder equity (asset) is increased to give a net zero effect on company valuation, essentially this is converting an asset into another form.  The newly issued shares would only dilute shareholders ownership thus have a negative effect on shareholders. Cash dividends have a different effect, impacting affect both the equity and cash accounts of a company. Their declaration results in a dividend payable (liability) on the balance sheet and a decrease in retained earning (asset) and once paid decreases, dividend payable and reduces cash balance (asset), thus the net effect is a reduction of firm value. That is, on ex dividend day, theoretically we expect that a stock value a company should decrease by a proportion equal to the amount that dividends are declared.

Empirically there a caveat to this relationship, early studies from Campbell and Beranek (1955) and Durand and May (1960), has shown that stock prices consistently fall by less than the amount of the dividend declared, a fact that is often attributed different tax treatment of dividends to captial gains. In soppurt, Elton and Gruber (1970) interpret the ex-dividend day behavior of common stock prices as evidence that differential rates of taxation cause investors to discount the value of taxable cash dividends relative to capital gains. They argue that the marginal investor who wishes to sell near the ex-dividend day is indifferent between selling on the ex-dividend day and selling on the previous day. More recently, Connelly, 2017 show that prices devaiations are caused by frictions within markets, that is 

The logical then becomes why companies pay dividends. 

# Constructed Dividend Portfolios {-}

From the dividend relevance theories, it can be concluded that dividend payments emanate from proxy arguments, rather than being considered an attractive feature in themselves. High dividend-paying companies can act as proxies for the quality of management structures over time, indicating their ability to consistently afford dividend payments. They can also signal prudent cash-flow management capabilities and often resemble value stocks (Basu, 1977). This is supported by research by Basu (1977), who used price-to-earnings ratios to predict stock performance and found that low price-to-earnings stocks tend to outperform their higher price-to-earnings counterparts.

When we consider the formula for dividend yield: $DY = \frac{EPS}{Price} \times Payout Ratio$, it becomes evident that dividend yield, when the payout ratio is held constant, is a function of earnings yield. Therefore, identifying low price-to-earnings stocks through dividends can serve as a proxy for value. However, it's important to note that value stocks carry higher levels of risk as they are more prone to financial distress and uncertainty in future earnings (Chen, 1998).

To address some of the negative aspects of high dividend yield (HY), dividend growth (DG) is used as a signal. DG stocks, unlike HY, are not affected by stock price but maintain properties that allow for inferences about management quality. As management is aware of the signaling effect of dividends, this may induce a "value trap," forcing management to continually increase dividends to maintain a certain valuation. However, such companies are more vulnerable to financial distress (Baker, 2009).

The "Dogs of the Dow" strategy, as explored by O'Higgins (1991), involves ranking 30 companies by HY and selecting the 10 highest-yielding shares for a portfolio. This strategy has shown superior returns compared to the Dow Jones Industrial Average (DJIA) and lower risk, achieving a higher Sharpe Ratio. Other studies across jurisdictions have yielded similar conclusions (Lemmon, 2015; Brzeszczynski, 2007; Visscher, 2003; Filbeck, 1997; Wang, 2011).

In South Africa, Fakir (2013) employed a parametric approach to investigate dividends as an investment strategy, further contributing to the literature on the topic.

# Data and Methodology {-}

## Data Treatment for Globally Traded Portfolios\label{int}

We use historical price data in table \ref{tabdes} from January 1 2003 to January 1 2023, a 20 year sample period. All of the studied indexes are considered gross total return in the same currency. Full descriptions on benchmark, dividend indexes are given in \ref{tabdes}.  Our metric of interest are annualized excess returns of individual indexes to their respective benchmarks following @bacon2023practical. To achieve this we scale observations to an annual scale by raising the compound return to the number of periods in a year, following this we take the root of total observations:

$\operatorname{Annualized Return} =\sqrt[n]{\operatorname{prod}\left(1+R_a\right)^{\text {scale}}}-1$

where $R_a$ is the return on the asset, $scale$ is the number of periods in a year, $n$ is the total number of periods. Following this, we simply take the difference of annualized return to get our excess return:

$\operatorname{Excess Return}=R_{p a}-R_{b a}$

where $R_{pa}$ are annualized return on the asset and $R_{ba}$ are annualized return of the benchmark. To calculate cumulative excess return, we take the product of excess returns over a period of time:

$\operatorname{Cumulative Excess Return}=\operatorname{prod}(1+ ER)-1$

We make other transformations to our international portfolio sample to get a nuanced perspective on performance during different time periods. For interest rate regime cycles we use interest rate schedules from central banks for country of domicile of the index. Likewise, we use proxies for volatility such as the VIX index in the United States, V2X in Europe and JALSH RV in South Africa.  That is, to proxy periods of high and low interest rates we stratify our sample interest rate hiking and cutting cycles where periods of sustained changes rate changes occur at least every five quarters. We also consider implied and realized equity market volatilities to proxy for different periods of market stability. After stratification, we geometrically chain the excess returns for the different periods before annualizing. To stratify amount of daily data for the respective interest rate cycles has to be large enough to annualized, however, if our proxies for volatility breach the top or bottom quintile for less than 50 trading days, the period is excluded in order to avoid annualizing small frequencies.

## South African Dividend Portfolios

We use historical daily price data in table \ref{tabdes} from January 1 2003 to July 7 2023, a roughly 20 year sample period for equity listed in the Johannesburg Stock Exchange and retrieve dividend yield ratios, dividend cover ratio, price momentum, price to earnings ratio, dividend growth per share. We construct our portfolios using signals on fundamental ratios and price momentum that are a blend of our selected ratios as described in Table \ref{signal} below. 

We construct our dividend by feeding into the optimizer ranked signals that does a aplha transformation on the signal. The optimizer makes slight modifications to the mean variance portfolio that considers risk preferences of investors [@markowitz1959portfolio]. Risk ($n$) assets is defined ($\sigma^2$) based on individual asset returns ($R_a$). We decompose returns into common factor ($X_f$) and specific return ($u$) as ($R_{a} = X_f+ u$). We the compute our covariance matrix as:

$XFX^T + D$,$\begin{array} {ll}X & =n \times k \text { matrix of asset exposures to the factors, } \\ F \quad &= k \times k \text { positive semi-definite factor covariance matrix, and } \\ D \quad &=n \times n \text { positive semi-definite covariance matrix representing a } \\ & \text { forecast of asset specific risk. }\end{array}$ 

For optimization purposes, our  $\sigma^2$) is considered in two forms: total risk, where only portfolio holdings are considered (benchmark holdings are irrelevant for the optimization process), and active risk, which takes into account the difference between portfolio holdings and benchmark holdings defined as:

*Total Risk*: $\quad h^T\left(\lambda_F X F X^T+\lambda_D D\right) h$

*Active Risk*: $\left(h-h_B\right)^T\left(\lambda_F X F X^T+\lambda_D D\right)\left(h-h_B\right)$
Where:
$$
\begin{aligned}
\lambda_F & =\text { common factor risk aversion parameter, } \\
\lambda_D & =\text { specific risk aversion parameter, } \\
h & =n \times 1 \text { vector of managed portfolio's holdings, and } \\
h_B & =n \times 1 \text { vector of normal (benchmark) portfolio's holdings }
\end{aligned}
$$

The following accounts for practical considerations in construct our portfolios. We use the Capped SWIX as our benchmark and $\lambda_f$ and $\lambda_D$ are set to 0.0075 and 1, respectively,  with active risk have an upper limit of 5%. For our box constraints, sector exposure can deviate from a range of 10% relative to the Capped SWIX and individual asset exposure is limited to 15%. Our portfolio turnover is limited to 10% and we exclude the property sector from our portfolios. 

# Results and Discussion{-}

We begin our analysis by evaluating several performance metrics of globally traded dividend portfolios. It is important to note that Table \ref{tab1} does not facilitate direct comparisons across indexes and regions due to differences in the inception dates of the respective instruments. Table \ref{tab1} presents four key performance measures, encompassing relative return (annualized excess return), total return (cumulative return), maximum drawdowns, and standard deviation. The latter two measures provide an initial insight into the risk characteristics of our selected investment universe, though a more detailed risk analysis will follow in our subsequent analysis.

An immediate observation from the table is that total returns, as assessed by cumulative returns, are positive for approximately 42% of the sample. Specifically, dividend yield (DY) strategies exhibit the highest total returns. When examining annualized excess returns, we notice that the majority of strategies outperform their respective benchmarks. However, it's worth noting that the relative performance against their benchmarks is marginal, with relative performance between - 0.01% to 0.01%.

Turning our attention to risk, we find that there is a narrow range in annualized standard deviation across most strategies. Nevertheless, drawdowns exhibit variation across strategies and regions. Drawdowns do not provide a definitive picture of the return characteristics of the constituents, but in broad terms, DY strategies tend to experience lower drawdowns compared to dividend growth (DG) strategies.

```{r Table1, results='asis'}

a <- readxl::read_xlsx("data/output.xlsx")

# this is the pre ample to the overall portfolio nalaysis that I will be conducting

data <- a %>% tibble::as_tibble()

table <- xtable(data, caption = "Global Index  Portfolio Performance \\label{tab1}")
  print.xtable(table,
             # tabular.environment = "longtable",
             floating = TRUE,
             table.placement = 'H',
             # scalebox = 0.3,
             comment = FALSE,
             caption.placement = 'bottom'
             )
```


A more discernible picture emerges as we stratify the performance of global dividend portfolios according to market volatility and interest rate cycles. Our categorization of market volatility into "High Vol" and "Low Vol" cycles is achieved through a two-step process. First, we calculate the rolling 12-month standard deviations of volatility proxies. Second, we identify the 5th and 95th percentiles of observations and extract the corresponding dates. Following this stratification, we calculate excess returns within these periods, geometrically chaining them and subsequently annualizing the excess returns with the appropriate periodicity.

Tables \ref{tab2} and \ref{tab3} present the performance of dividend portfolios during periods of market distress (Hi Vol) and market calm (Lo Vol). This stratification allows for comparisons across regions and strategies, although it's crucial to be aware that the duration of market volatility can impact strategy performance.

From our stratification, we find that 37.5% of observations yield positive excess returns. Among those, HY indexes, which constitute approximately 67% of the portfolios with positive returns, tend to perform better in periods of market distress compared to market calm. In fact, most indexes in the high volatility periods exhibit returns close to 0%. For instance, in Hi Vol conditions, HY consistently outperforms DG strategies, with SA_HY (2.74%) outperforming SA_DG (-4.07%), EU_HY (0.08%) outperforming EU_DG (-4.84%), and US_HY (-0.35%) outperforming US_DG (-0.68%).

In contrast, during Lo Vol periods, we observe greater dispersion in annualized excess returns, making it less clear whether prolonged periods of market calm lead to lower returns. The performance is less consistent in low volatility periods. Overall, our market cycle stratification reveals that DY and DG strategies tend to offer defensive characteristics in periods of higher volatility. However, it's important to note that only a few of our portfolios generate positive excess returns in these periods. Therefore, idiosyncrasies within the market play a significant role in determining the performance of these signals.

```{r Table2, results='asis'}

 vol_data <- readxl::read_xlsx("data/volatility for indexes.xlsx") %>% gather(index, px , -Date) %>% 
  mutate(ret = px/lag(px)-1, RollSD = RcppRoll::roll_sd(1 + ret, 12, fill = NA, align = "right") * 
             sqrt(12)) %>% 
    filter(!is.na(RollSD))

# # get the top quartile and bottom quartile
 strat_df <- vol_data %>% filter(index == "VIX") %>%  mutate(topQ = quantile(RollSD, probs = 0.90), 
               botQ = quantile(RollSD, probs = 0.1),
               Strat = ifelse(RollSD >= topQ, "HiVol", 
                           ifelse(RollSD <= botQ, "LowVol", "Normal_Vol")))
 
# # US strat
 
 hivol_per_vector_us <- strat_df %>% filter(Strat %in% "HiVol") %>% pull(Date)
 lovol_per_vector_us <- strat_df %>% filter(Strat %in% "LowVol") %>% pull(Date)

 # UK 

 strat_df <-vol_data %>% filter(index == "IVIUK") %>% mutate(topQ = quantile(RollSD, probs = 0.90), 
               botQ = quantile(RollSD, probs = 0.1),
              Strat = ifelse(RollSD >= topQ, "HiVol", 
                          ifelse(RollSD <= botQ, "LowVol", "Normal_Vol")))
# 
 hivol_per_vector_uk  <- strat_df %>% filter(Strat %in% "HiVol") %>% pull(Date)
 lovol_per_vector_uk  <- strat_df %>% filter(Strat %in% "LowVol") %>% pull(Date)
#  EU 
 
 strat_df <-vol_data %>% filter(index == "V2X") %>% mutate(topQ = quantile(RollSD, probs = 0.95), 
               botQ = quantile(RollSD, probs = 0.05),
              Strat = ifelse(RollSD >= topQ, "HiVol", 
                          ifelse(RollSD <= botQ, "LowVol", "Normal_Vol")))
# 
 hivol_per_vector_eu  <- strat_df %>% filter(Strat %in% "HiVol") %>% pull(Date)
 lovol_per_vector_eu  <- strat_df %>% filter(Strat %in% "LowVol") %>% pull(Date) 
# # SA 

 strat_df <-vol_data %>% filter(index == "SAVIT40") %>% mutate(topQ = quantile(RollSD, probs = 0.9), 
               botQ = quantile(RollSD, probs = 0.1),
               Strat = ifelse(RollSD >= topQ, "HiVol", 
                           ifelse(RollSD <= botQ, "LowVol", "Normal_Vol")))
# 
 hivol_per_vector_sa <- strat_df %>% filter(Strat %in% "HiVol") %>% pull(Date)
 lovol_per_vector_sa <- strat_df %>% filter(Strat %in% "LowVol") %>% pull(Date)

#  High Vol df 
 
source("code/Stratifier.R")
  
stratifying_df <-  bind_rows(
 stratifier(df, "EU_HY", "EU", hivol_per_vector_eu, "High Vol" ),
 stratifier(df, "EU_DG", "EU_2", hivol_per_vector_eu, "High Vol" ),
 stratifier(df, "UK_HY", "UK", hivol_per_vector_eu, "High Vol" ),
 stratifier(df, "UK_HY_B", "UK", hivol_per_vector_eu, "High Vol"),
 stratifier(df, "JP_HY", "JP", hivol_per_vector_us, "High Vol"),
 stratifier(df, "JP_DG", "JP", hivol_per_vector_us, "High Vol"),
 stratifier(df, "EM_HY", "EM", hivol_per_vector_us, "High Vol"),
 stratifier(df, "SA_HY", "SA", hivol_per_vector_sa, "High Vol"),
 stratifier(df, "SA_DG", "SA", hivol_per_vector_sa, "High Vol"),
 stratifier(df, "US_HY", "US", hivol_per_vector_us, "High Vol"), 
 stratifier(df, "US_DG", "US", hivol_per_vector_us, "High Vol"), 
 stratifier(df , "W_HY", "W", hivol_per_vector_us, "High Vol"), 
 stratifier(df, "EU_HY", "EU", lovol_per_vector_eu, "Low Vol Period" ),
 stratifier(df, "EU_DG", "EU_2", lovol_per_vector_eu, "Low Vol Period" ),
 stratifier(df, "UK_HY", "UK", lovol_per_vector_eu, "Low Vol Period" ),
 stratifier(df, "UK_HY_B", "UK", lovol_per_vector_eu, "Low Vol Period" ),
 stratifier(df, "JP_HY", "JP", lovol_per_vector_us, "Low Vol Period" ),
 stratifier(df, "JP_DG", "JP", lovol_per_vector_us, "Low Vol Period" ),
 stratifier(df, "EM_HY", "EM", lovol_per_vector_us, "Low Vol Period" ),
 stratifier(df, "SA_HY", "SA", lovol_per_vector_sa, "Low Vol Period" ),
 stratifier(df, "SA_DG", "SA", lovol_per_vector_sa, "Low Vol Period" ),
 stratifier(df, "US_HY", "US", lovol_per_vector_us, "Low Vol Period" ), 
 stratifier(df, "US_DG", "US", lovol_per_vector_us, "Low Vol Period" ), 
 stratifier(df, "W_HY", "W", lovol_per_vector_us, "Low Vol Period")
 )

stratifying_df_o <- stratifying_df %>% arrange(desc(`Annualized Return (%)`)) %>% arrange(desc(`Annualized Return (%)`)) %>% filter(`Annualized Return (%)`>0)
stratifying_df_u <- stratifying_df %>% arrange(desc(`Annualized Return (%)`)) %>% arrange(desc(`Annualized Return (%)`)) %>% filter(`Annualized Return (%)`<0)

data_o = stratifying_df_o %>% tibble::as_tibble()
  addtorow          <- list()
  addtorow$pos      <- list()
  addtorow$pos[[1]] <- c(0)
  addtorow$command  <- c(paste("\\hline \n",
                               "\\endhead \n",
                               "\\hline \n",
                               "{\\footnotesize Continued on next page} \n",
                               "\\endfoot \n",
                               "\\endlastfoot \n",sep=""))
data_u = stratifying_df_u %>% tibble::as_tibble()
  addtorow          <- list()
  addtorow$pos      <- list()
  addtorow$pos[[1]] <- c(0)
  addtorow$command  <- c(paste("\\hline \n",
                               "\\endhead \n",
                               "\\hline \n",
                               "{\\footnotesize Continued on next page} \n",
                               "\\endfoot \n",
                               "\\endlastfoot \n",sep=""))
  
table <- xtable(data_o, caption = "Over Performance Volatility Stratification\\label{tab2}")
  print.xtable(table,
             tabular.environment = "longtable",
             floating = FALSE, # Leave this as is.
             table.placement = 'H', # Leave this as is.
             booktabs = T, # Aesthetics
             include.rownames = FALSE,  # Typically you don't want this in a table.
             add.to.row = addtorow, # For adding the Continued on next page part...
             comment = FALSE,
             caption.placement = 'bottom',  # Where do you want the caption?
             size="\\fontsize{12pt}{13pt}\\selectfont"  # Size of text in table..
             )
  
table <- xtable(data_u, caption = "Under Performance Volatility Stratification\\label{tab3}")
  print.xtable(table,
             tabular.environment = "longtable",
             floating = FALSE, # Leave this as is.
             table.placement = 'H', # Leave this as is.
             booktabs = T, # Aesthetics
             include.rownames = FALSE,  # Typically you don't want this in a table.
             add.to.row = addtorow, # For adding the Continued on next page part...
             comment = FALSE,
             caption.placement = 'bottom',  # Where do you want the caption?
             size="\\fontsize{12pt}{13pt}\\selectfont"  # Size of text in table..
             )

```

When we stratify our analysis according to interest rate cycles in Tables \ref{tab4} and \ref{tab5,} focusing on Hiking, Cutting, and Neutral cycles, we encounter an interesting anomaly in Japan. Unlike other economies, Japan does not have distinct hiking or cutting cycles, as its central bank has largely maintained constant interest rates. Therefore, we exclusively assess Japan's performance within the confines of a neutral interest rate cycle.
Upon stratification, we geometrically chain quarterly excess returns and then annualize them to enable comparisons across indices. Our analysis reveals several insights. The average and median annualized cumulative excess returns of the US and EU dividend indexes during cutting cycles suggest that DG strategies tend to outperform, particularly when interest rates are declining. Underperformance during hiking cycles is less pronounced in the US, especially when considering annualized excess returns between Hiking and Cutting cycles. Finally, EU, both DY and DG strategies exhibit outperformance during hiking cycles, with dividend growth strategies outperforming to a greater extent. To provide further context for this analysis, we include results from a principal component analysis on returns of each dividend portfolio and its benchmark in Appendix 2. After identifying the principal components, we regress the first three principal components against returns to formalize our assessment of the return drivers for our portfolios. Notably, dividend portfolios, whether high yield (HY) or dividend growth (DG), exhibit similar loadings relative to their benchmarks, although the loadings are slightly larger. Given practical considerations in constructing indexes and the results from our models, we posit that dividend portfolios may effectively proxy the market index, providing investors with exposure similar to the hypothetical index.


```{r Table3, results='asis'}
rate_data <- readxl::read_xlsx("data/Policy Rates.xlsx") 

names <- c("Date", "US", "UK", "JP", "ECB", "SA")

colnames(rate_data) <- names

US_rates <- rate_data %>% select(Date, US)
UK_rates <- rate_data %>% select(Date, UK)
JP_rates <- rate_data %>% select(Date, JP)
SA_rates <- rate_data %>% select(Date, SA)
ECB_rates <- rate_data %>% select(Date, ECB)
# Get Rates for the US
source("code/Interest_Regime.R")
source("code/Stratifier_rates.R")


#  rename the columns for the function to work

Regime_df <- Regime_change_df(US_rates, "US", 5)
Hiking_date_vector_us <- Regime_df %>% filter(regime %in% "Hiking") %>% pull(Date)
Cutting_date_vector_us <- Regime_df %>% filter(regime %in% "Cutting") %>% pull(Date)
Neutral_date_vector_us <- Regime_df %>% filter(regime %in% "Neutral") %>% pull(Date) 

Regime_df <- Regime_change_df(UK_rates, "UK", 5)
Hiking_date_vector_uk <- Regime_df %>% filter(regime %in% "Hiking") %>% pull(Date)
Cutting_date_vector_uk <- Regime_df %>% filter(regime %in% "Cutting") %>% pull(Date)
Neutral_date_vector_uk <- Regime_df %>% filter(regime %in% "Neutral") %>% pull(Date) 

Regime_df <- Regime_change_df(JP_rates, "JP", 5)
Hiking_date_vector_jp <- Regime_df %>% filter(regime %in% "Hiking") %>% pull(Date)
Cutting_date_vector_jp <- Regime_df %>% filter(regime %in% "Cutting") %>% pull(Date)
Neutral_date_vector_jp <- Regime_df %>% filter(regime %in% "Neutral") %>% pull(Date) 

Regime_df <- Regime_change_df(SA_rates, "SA", 5)
Hiking_date_vector_sa <- Regime_df %>% filter(regime %in% "Hiking") %>% pull(Date)
Cutting_date_vector_sa <- Regime_df %>% filter(regime %in% "Cutting") %>% pull(Date)
Neutral_date_vector_sa <- Regime_df %>% filter(regime %in% "Neutral") %>% pull(Date) 

Regime_df <- Regime_change_df(ECB_rates, "ECB", 5)
Hiking_date_vector_eu <- Regime_df %>% filter(regime %in% "Hiking") %>% pull(Date)
Cutting_date_vector_eu <- Regime_df %>% filter(regime %in% "Cutting") %>% pull(Date)
Neutral_date_vector_eu <- Regime_df %>% filter(regime %in% "Neutral") %>% pull(Date) 
# Hiking Performance

Hiking_performance <-  bind_rows(
 stratifier_rates(df, "EU_HY", "EU", Hiking_date_vector_eu, "Hiking" ),
 stratifier_rates(df, "EU_DG", "EU_2", Hiking_date_vector_eu, "Hiking" ),
 stratifier_rates(df, "UK_HY", "UK", Hiking_date_vector_uk, "Hiking" ),
 stratifier_rates(df, "UK_HY_B", "UK", Hiking_date_vector_uk, "Hiking" ),
 stratifier_rates(df, "EM_HY", "EM", Hiking_date_vector_us, "Hiking"),
 stratifier_rates(df, "SA_HY", "SA", Hiking_date_vector_sa, "Hiking" ),
 stratifier_rates(df, "SA_DG", "SA", Hiking_date_vector_sa, "Hiking" ),
 stratifier_rates(df, "US_HY", "US", Hiking_date_vector_us, "Hiking" ), 
 stratifier_rates(df, "US_DG", "US", Hiking_date_vector_us, "Hiking" )
 )

#  Cutting Perfromance

Cutting_performance <-  bind_rows(
 stratifier_rates(df, "EU_HY", "EU", Cutting_date_vector_eu, "Cut" ),
 stratifier_rates(df, "EU_DG", "EU_2", Cutting_date_vector_eu, "Cut" ),
 stratifier_rates(df, "UK_HY", "UK", Cutting_date_vector_uk, "Cut" ),
 stratifier_rates(df, "UK_HY_B", "UK", Cutting_date_vector_uk, "Cut" ),
 stratifier_rates(df, "EM_HY", "EM", Cutting_date_vector_us, "Cut"),
 stratifier_rates(df, "SA_HY", "SA", Cutting_date_vector_sa, "Cut" ),
 stratifier_rates(df, "SA_DG", "SA", Cutting_date_vector_sa, "Cut" ),
 stratifier_rates(df, "US_HY", "US", Cutting_date_vector_us, "Cut" ), 
 stratifier_rates(df, "US_DG", "US", Cutting_date_vector_us, "Cut" )
 )

# Nuetral 

Nuetral_perfromance <-  bind_rows(
 stratifier_rates(df, "EU_HY", "EU", Neutral_date_vector_eu, "Neutral" ),
 stratifier_rates(df, "EU_DG", "EU_2", Neutral_date_vector_eu, "Neutral" ),
 stratifier_rates(df, "UK_HY", "UK", Neutral_date_vector_uk, "Neutral" ),
 stratifier_rates(df, "UK_HY_B", "UK", Neutral_date_vector_uk, "Neutral" ),
 stratifier_rates(df, "JP_HY", "JP", Neutral_date_vector_jp, "Neutral" ),
 stratifier_rates(df, "JP_DG", "JP", Neutral_date_vector_jp, "Neutral" ),
 stratifier_rates(df, "EM_HY", "EM", Neutral_date_vector_us, "Neutral"),
 stratifier_rates(df, "SA_HY", "SA", Neutral_date_vector_sa, "Neutral" ),
 stratifier_rates(df, "SA_DG", "SA", Neutral_date_vector_sa, "Neutral" ),
 stratifier_rates(df, "US_HY", "US", Neutral_date_vector_us, "Neutral" ), 
 stratifier_rates(df, "US_DG", "US", Neutral_date_vector_us, "Neutral" )
 )

CB_df <- bind_rows(Nuetral_perfromance, 
 Cutting_performance, Hiking_performance) %>% arrange(desc(`Annualized Return (%)`))

CB_o <- CB_df %>% rename(Quarters = "Months") %>% filter(Quarters > 5) %>% ungroup() %>% filter(`Annualized Return (%)`>0)
CB_u <- CB_df %>% rename(Quarters = "Months") %>% filter(Quarters > 5) %>% ungroup() %>% filter(`Annualized Return (%)`<0)


i = CB_o %>% tibble::as_tibble()
  addtorow          <- list()
  addtorow$pos      <- list()
  addtorow$pos[[1]] <- c(0)
  addtorow$command  <- c(paste("\\hline \n",
                               "\\endhead \n",
                               "\\hline \n",
                               "{\\footnotesize Continued on next page} \n",
                               "\\endfoot \n",
                               "\\endlastfoot \n",sep=""))
r = CB_u %>% tibble::as_tibble()
  addtorow          <- list()
  addtorow$pos      <- list()
  addtorow$pos[[1]] <- c(0)
  addtorow$command  <- c(paste("\\hline \n",
                               "\\endhead \n",
                               "\\hline \n",
                               "{\\footnotesize Continued on next page} \n",
                               "\\endfoot \n",
                               "\\endlastfoot \n",sep=""))
  
  
table <- xtable(i, caption = "Over Performance in Interest Rate Regimes\\label{tab4}")
  print.xtable(table,
             tabular.environment = "longtable",
             floating = FALSE, # Leave this as is.
             table.placement = 'H', # Leave this as is.
             booktabs = T, # Aesthetics
             include.rownames = FALSE,  # Typically you don't want this in a table.
             add.to.row = addtorow, # For adding the Continued on next page part...
             comment = FALSE,
             caption.placement = 'bottom',  # Where do you want the caption?
             size="\\fontsize{12pt}{13pt}\\selectfont"  # Size of text in table..
             )
  
table <- xtable(r, caption = "Under Performance in Interest Rate Regimes\\label{tab5}")
  print.xtable(table,
             tabular.environment = "longtable",
             floating = FALSE, # Leave this as is.
             table.placement = 'H', # Leave this as is.
             booktabs = T, # Aesthetics
             include.rownames = FALSE,  # Typically you don't want this in a table.
             add.to.row = addtorow, # For adding the Continued on next page part...
             comment = FALSE,
             caption.placement = 'bottom',  # Where do you want the caption?
             size="\\fontsize{12pt}{13pt}\\selectfont"  # Size of text in table..
             )

```


In our final analysis, we consider a dynamic measure to evaluate the risk-adjusted performance of dividend portfolios over time. Figure \ref{fig1} provides a visual representation of the consistency in the performance of dividend portfolios. We achieve this by employing a rolling 60-month information ratio, which helps avoid the influence of short-term events that may skew performance results. This ratio is computed by determining the rolling excess return of the index relative to its benchmark and then dividing this by the volatility of those excess returns. The red line in the figure represents out performance relative to the benchmark while considering risk, serving as a yardstick to assess satisfactory performance. From Figure \ref{fig1}, UK_HY exhibits undesirable consistency in returns over the sample period. The EM and Japan dividend portfolios exhibit polarizing performances throughout the sample period. From 2005 to 2015, returns for these portfolios were consistently positive, but over the last eight years, information ratios have been negative.

In contrast, South African portfolios, particularly dividend growth portfolios, have shown positive information ratios since 2010 to 2020. SA_HY only turned positive since 2017. The US and EU indexes exhibit similar intra-region performance, with information ratios that remain close to 0 and show minimal deviation over time. Overall, our analysis based on information ratios yields similar results to our whole sample analysis on total return in Table \ref{tab1}. It suggests that dividend strategies, with the exception of SA_HY (which has seen a steady decline in its information ratio), generally fail to outperform their benchmark. This result contradicts our findings from stratification, where we observed outperformance of dividend strategies in low-interest rate environments or periods of high volatility. The varying performance of these strategies highlights their sensitivity to the economic and market conditions in which they operate.  

```{r, fig.align='left', fig.cap="Rolling 3 Year Returns \\label{fig1}", fig.ext='png', fig.height=4, fig.width=7}

source("code/InformationRatioRoll.R")

a <-  df %>% Information_Ratio_Roll(., "EU_HY", "EU", 20030104, 60)
b <-  df %>% Information_Ratio_Roll(., "EU_DG", "EU_2",20030104, 60)
 c <- df %>% Information_Ratio_Roll(., "UK_HY", "UK", 20030104, 60)
 d <- df %>% Information_Ratio_Roll(., "UK_HY_B", "UK", 20030104, 60)
 e <- df %>% Information_Ratio_Roll(., "JP_HY", "JP", 20030104,60)
 f <- df %>% Information_Ratio_Roll(., "JP_DG", "JP", 20030104, 60)
 g <- df %>% Information_Ratio_Roll(., "EM_HY", "EM", 20030104, 60)
 h <- df %>% Information_Ratio_Roll(., "SA_HY", "SA", 20030104, 60)
 i <- df %>% Information_Ratio_Roll(., "SA_DG", "SA", 20030104, 60)
 j <- df %>% Information_Ratio_Roll(., "US_HY", "US", 20030104, 60)
 k <- df %>% Information_Ratio_Roll(., "US_DG", "US_2", 20030104, 60)

consistency_df <- list(a, b, c, d, e,f,g,h,i,j,k) %>%
  reduce(inner_join, by='date') %>% 
  gather(IR , ret, -date) 
 
consistency_df %>%
  ggplot() + 
  geom_line(aes(date, ret), color = "steelblue", size = 1.1, alpha = 0.8) +
  geom_hline(yintercept = 0, color = "red", size = 0.3, alpha = 0.5) +
  facet_wrap(~IR) +
  gabriel_theme +  
  labs(title = "Information Ratio Changes", subtitle = "Assessing return consistency", caption = "Source: Bloomberg and author calculations",  x = NULL)
```

# Application to South Africa{-}

## Backtest Results from Dividend Portfolio Signals{-}


Figure \ref{fig3} provides a visual representation of the cumulative returns of our dividend portfolios, along with a display of the total capital invested during the sample period. These portfolios are categorized into Dividend Yield (DY), Dividend Growth (DG), Price Momentum, and Sustainability, and they are compared to the performance benchmark represented by the SWIX Top 40 index. In line with our earlier analysis of the SA_HY and SA_DG portfolios, a noticeable pattern emerges, indicating that the returns over the sample period fall short of the benchmark set by the market index. Furthermore, our vanilla portfolio, Dividend High Yield (HY), displays the lowest cumulative returns. Similarly, the Price Momentum and Sustainability portfolios exhibit diminished performance when compared to both the Value and DG portfolios. This observation highlights a consistent trend of underperformance in our portfolios when evaluated against the broader market index.

This outcome prompts further examination and investigation to uncover the underlying factors and potential implications within the context of dividend-oriented investment strategies. It is essential to understand the reasons behind this consistent underperformance and consider adjustments or enhancements to the strategies to potentially improve their effectiveness.
```{r Figure3,  warning =  FALSE, fig.align = 'left', fig.cap = "Rolling 3 Year Returns \\label{fig3}", fig.ext = 'png', fig.height = 4, fig.width =7}
# Visuals on total ROI 

Loc <- "J433_J406/Divi/"
Loc_2 <- "J433_J406/Divi/Capped_SWIX/"
source("/Users/gabrielrambanapasi/Desktop/Much Ado Dividends/Much-Ado-Dividends/Thesis/write up/code/Get_dat_1.R")
source("/Users/gabrielrambanapasi/Desktop/Much Ado Dividends/Much-Ado-Dividends/Thesis/write up/code/EOM.R")
source("code/Theme.R")


df1 <- Get_dat(Loc, Loc_2,Port = "Divi1","Returns")
df2 <- Get_dat(Loc, Loc_2,Port = "Divi2","Returns")
df3 <- Get_dat(Loc, Loc_2,Port = "Divi3","Returns")
df4 <- Get_dat(Loc, Loc_2,Port = "Divi4","Returns")
dfbm <- Get_dat(Loc, Loc_2,Port = "Divi1","Returns_BM")
df <- bind_rows(df1, df2, df3, df4, dfbm %>% rename(Returns = BM_Returns) %>% mutate(Portfolio = "BM")) %>% select(date, Portfolio, Returns) %>% ungroup() %>% select(-YM)

# get the cumulative returns 

df %>% group_by(Portfolio) %>%  mutate(ROI = cumprod(1+Returns), ROI = ROI/first(ROI)) %>% ggplot + geom_line(aes(date, ROI, color = Portfolio))+gabriel_theme +  
  labs(title = " Return On Investment", subtitle = "Backtest Results on Dividend Portfolios", caption = "Source: Bloomberg and author calculations",  x = NULL)+
  gabriel_theme
```

Tables \ref{tab6} and \ref{tab7} offer a detailed breakdown of total investments during periods characterized by market cycles and interest rate regimes, specifically high or low volatility, and hiking or cutting cycles. These categorizations align with the realized market volatility and interest rate regime stratification dates we used in our analysis of Tables \ref{tab2} and \ref{tab3} for the SA_HY and SA_DG indexes.

Consistent with our findings from internationally traded portfolios, we once again observe the favorable characteristics of dividend portfolios when stratified according to interest rate regimes and volatility levels. Notably, these dividend portfolios exhibit significant defensive attributes, with the price momentum-adjusted and sustainability portfolios generating the highest returns during hiking periods and times of high volatility. Furthermore, it's essential to emphasize that our portfolios consistently outperform the market index during these periods.

These results highlight the resilience and attractiveness of dividend-oriented investment strategies in challenging market conditions, underscoring their potential as a valuable component of an investor's portfolio. Further analysis and research could shed more light on the underlying factors contributing to this outperformance and help investors make informed decisions in constructing their portfolios.

```{r, results='asis'}
df_volatility <- bind_rows (df %>%  filter(date %in% hivol_per_vector_sa) %>% mutate(roi = cumprod(1+Returns)) %>% group_by(Portfolio) %>%  summarise(Months = n(), ROI  = last(roi),  `Ann ROI %` = ROI^Months/12 -1, `SD %` = sd(roi)) %>% mutate(MarketCycle = "High Volatility "),

df %>%  filter(date %in% lovol_per_vector_sa) %>% mutate(roi = cumprod(1+Returns)) %>% group_by(Portfolio) %>%   summarise(Months = n(), ROI  = last(roi),  `Ann ROI %` = ROI^Months/12 -1, `SD %`= sd(roi))  %>% mutate(MarketCycle = "Low Volatility ") )

library(xtable)
data <- df_volatility %>% select(-Months) %>%  tibble::as_tibble()

table <- xtable(data, caption = "Market Cycle Perforomance \\label{tab6} ")
  print.xtable(table,
             # tabular.environment = "longtable",
             floating = TRUE,
             table.placement = 'H',
             # scalebox = 0.3,
             comment = FALSE,
             caption.placement = 'bottom'
             )
```

During cutting cycles or during periods characterized by low market volatility, an examination of the correlation between market cycles and the performance of South African portfolios reveals a consistent and noteworthy relationship. Specifically, in such scenarios, akin to the broader spectrum of return on investment, it becomes evident that the market index tends to yield relatively superior returns. It is worth noting that among the various portfolios under scrutiny, our DIVI2 portfolio has exhibited a relative underperformance when compared to our other dividend portfolios. Consequently, this analysis leads to the inference that dividend-oriented portfolios can serve as an effective instrument for investors seeking to augment their returns during phases of heightened market volatility.

```{r, results= "asis"}
df_interest <- bind_rows(df %>%  filter(date %in% Hiking_date_vector_sa) %>% mutate(roi = cumprod(1+Returns)) %>% group_by(Portfolio) %>%  summarise(Months = n(), ROI  = last(roi),  `Ann ROI %` = ROI^4/Months -1, `SD %` = sd(roi))  %>% mutate(MarketCycle = "Hiking")%>% filter(Months >1),

df %>%  filter(date %in% Neutral_date_vector_sa) %>% mutate(roi = cumprod(1+Returns)) %>% group_by(Portfolio) %>%  summarise(Months = n(), ROI  = last(roi),  `Ann ROI %` = ROI^4/Months -1, `SD %` = sd(roi))  %>% mutate(MarketCycle = "Neutral")%>% filter(Months >1)  ,

df %>%  filter(date %in% Cutting_date_vector_sa) %>% mutate(roi = cumprod(1+Returns)) %>% group_by(Portfolio) %>%  summarise(Months = n(), ROI  = last(roi),  `Ann ROI %` = ROI^4/Months -1, `SD %` =sd(roi)) %>% mutate(MarketCycle = "Cutting")  %>% filter(Months >1) )

library(xtable)
data <- df_interest %>% select(-Months) %>% tibble::as_tibble()

table <- xtable(data, caption = "Interest Rate Regime Performance \\label{tab7}")
  print.xtable(table,
             # tabular.environment = "longtable",
             floating = TRUE,
             table.placement = 'H',
             # scalebox = 0.3,
             comment = FALSE,
             caption.placement = 'bottom'
             )
```

```{r}
df1_h <- Get_dat(Loc, Loc_2,Port = "Divi1","Holds") %>% mutate(Portfolio = "Divi1")
df2_h <- Get_dat(Loc, Loc_2,Port = "Divi2","Holds")%>% mutate(Portfolio = "Divi2")
df3_h <- Get_dat(Loc, Loc_2,Port = "Divi3","Holds")%>% mutate(Portfolio = "Divi3")
df4_h <- Get_dat(Loc, Loc_2,Port = "Divi4","Holds")%>% mutate(Portfolio = "Divi4")
dfh <- bind_rows(df1_h, df2_h, df3_h, df4_h) %>% ungroup() %>% select(-YM)

loc_bm <- list.files("J433_J406/Divi/Capped_SWIX/", pattern = "\\.rds$", full.names = TRUE)

dfh_bm <- loc_bm[grepl("Holdings.rds", loc_bm)] %>% read_rds(.) %>% select(date, Tickers, Name, BM_Weight = Weight, Sector ) %>% mutate(Sector = gsub("N/A", NA, Sector))  %>% Make_calendar_EOM(.)%>% arrange(date) %>%  ungroup()

dfh_bm <- dfh_bm  %>%
  mutate(Month = format(date, "%b"),Year = format(date, "%Y")) %>% 
  group_by(Year, Name) %>% 
  filter(Month %in% c("Oct")) %>% ungroup() %>% select(-Year , -Month) 
  
# selecting last quarter rebalancing

dfh <- dfh  %>%
  mutate(Month = format(date, "%b"),Year = format(date, "%Y")) %>% 
  group_by(Year, Name, Portfolio) %>% 
  filter(Month %in% c("Oct"))%>% ungroup() %>% select( -Month, -Year)

# get the deviations
dates_to_filter <- full_join(dfh, dfh_bm, by = c("date", "Name", "Tickers")) %>% select(-YM) %>% mutate(excess_wts = Weight - BM_Weight) %>% filter(!is.na(Weight)) %>% select(date) %>% arrange(date) %>% pull() %>% unique()

# I am looking into return attribution more than risk attribution, so lets analyze the impact of the active decisions from the divi portfolios. Maybe bring in some aspects of micro attribution, ones that are consistent with style.

# accucracy is imparove in short time intervals, most appropriate for little turnover
```

To ascertain the periods during which our dividend portfolios offer value, we implement a relative performance evaluation method by computing the product of excess returns and excess weights, yielding a relative performance metric. This involves calculating the disparity in monthly excess returns from the most recent rebalancing date within our back-testing, conducted annually in October, covering the period from October 30, 2007, to October 30, 2022^[It is crucial to note that within our analysis of back-test results, there were instances, specifically on October 30, 2008, where no weight data was available for any of the portfolios. Consequently, these specific data points have been excluded from our analysis, as their isolated occurrence did not exert a significant influence on the overarching long-term trends, thus upholding the overall integrity of our analysis. Also, it is important to emphasize that our analysis does not consider sector-specific returns and weights for the portfolios and benchmarks. Nevertheless, we enhance our measurement by amalgamating the excess returns and excess weights to derive a return attribution analysis for the comprehensive strategy. This refined approach enables us to discern subtle performance nuances attributed to strategic decisions concerning the overweighting or underweighting of assets during opportune moments. For an in-depth exploration of the rationale underlying our use of this return attribution methodology and its merits, interested readers are encouraged to refer to the work of @brinson1985measuring ]


Figure \ref{fig4}, visually represents our metric for assessing relative return performance, encompassing the influence of excess weights across our entire investment horizon.

```{r,  warning =  FALSE, fig.align = 'left', fig.cap = "Rolling 3 Year Returns \\label{fig4}", fig.ext = 'png', fig.height = 4, fig.width =7}
# from our excess returns calc , this data just has divi excess returns, join by date
Excess_returs_divi <- df %>% 
  filter(date %in% dates_to_filter) %>% 
  spread(Portfolio, Returns) %>%
  mutate_at(3:6, ~ (.)- BM ) %>% select(-BM) %>% ungroup() %>% 
  gather(index, ex_ret, -date)

#  excess weights 

Excess_weights <-  full_join(dfh_bm, dfh, by = c("date", "Name", "Tickers"))  %>%
  arrange(date) %>% 
filter(date %in% dates_to_filter) %>% 
filter(!is.na(Portfolio)) %>% 
group_by(Portfolio, date) %>%
summarize(Index_Weight =Weight/sum(Weight), BM_Weight = BM_Weight/sum(BM_Weight)) %>%
mutate(ExcessWeight = (Index_Weight - BM_Weight)) %>% 
  summarize( ExcessWeight= mean(ExcessWeight)) %>% spread(Portfolio, ExcessWeight) %>%
  gather(index, ex_weight, -date)

# combine to get the BR DF 
BF_df <- left_join(Excess_weights, Excess_returs_divi, c("date", "index")) %>% filter(!is.na(ex_weight)) %>%  mutate(BR = ex_weight * ex_ret) %>% select(date, BR, index)

#  there are momnets in which we dont have the ex_weight for all portfolios in 2008, just going to excleude them from the anal;ysis


g <- BF_df %>% 
  ggplot(aes(date, BR)) + 
  geom_smooth() + 
  facet_grid(~index) +
  gabriel_theme + 
  labs(title = " Relative Performance", subtitle = "Backtest Results on Dividend Portfolios", caption = "Source: Bloomberg and author calculations",  x = NULL)
g <- g + scale_y_continuous(labels = scales::number_format(scale = 0.01))

# get the hit range of the strategy throughout time 
Hit_df <- left_join(Excess_weights, Excess_returs_divi, by = c("date", "index")) %>%
  filter(!is.na(ex_weight)) %>%
  mutate(BR = ex_weight * ex_ret) %>%
  select(date, BR, index) %>%
  group_by(index) %>%
  mutate(Positive = sum(BR > 0), Tot = n()) %>% summarize(`Hit Rate` = mean(Positive/Tot ))

g +
  geom_text(
    data = Hit_df,
    aes(label = paste("Hit Rate:", scales::percent(`Hit Rate`))),
    x = Inf,
    y = Inf,
    hjust = 1,
    vjust = 1,
    show.legend = FALSE,
    nudge_x = -0.02
  )
```
In contrast to the findings presented in \ref{fig3}, where all dividend signals yielded diminished Return on Investment (ROI) over the course of our comprehensive back-test period, our dividend portfolio displayed superior performance compared to the Capped SWIX Top 50 index, as measured by Hit Rates (HR). Specifically, Divi1 exhibited a HR of 50%, Divi2 achieved a HR of 42.9%, Divi3 attained a remarkable HR of 68.8%, and Divi4 registered a HR of 31.2% during the observed period.

Significantly, our value-oriented portfolio (Divi 3) exhibited the highest HR among the dividend portfolios, followed by Divi 1, Divi 2, and Divi 4, in descending order. While these results align with our ROI analysis for the first portfolio, it is important to note that the sequence of performance differs for Divi 4, Divi 1, and Divi 2.

Based on this comprehensive analysis, we draw the conclusion that the utilization of a proxy for value, as opposed to a strict dividend signal, contributes more significantly to the overall performance of 

\newpage
# Conclusion {-}


Over the course of time, dividend portfolios, encompassing both DY and DG strategies, have consistently displayed positive excess returns, evident in the cumulative excess return figures. Although the UK_HY index notably exhibits the highest cumulative return, this trend is not uniformly observed across various regional indexes. However, when we segment these portfolios based on different periods of market volatility, a distinct pattern emerges. During phases of heightened market volatility, dividend strategies prove to be effective in providing capital protection when integrated into a diversified asset portfolio. Furthermore, during such high volatility periods, DY strategies outperform the  DG strategies. An intriguing observation is that South African portfolios tend to perform well during these high volatility periods, which is somewhat unconventional, given that such times are typically associated with a flight to safety. Emerging Markets (EM) and, by extension, South Africa, are generally perceived as riskier investments.

Expanding our analysis to incorporate interest rate cycles reveals a contrasting effect compared to the volatility-based stratification. It becomes evident that all strategies tend to yield the highest returns during low interest rate cycles. Information ratio analysis indicates that dividend strategies generally do not exhibit consistent return performance. At a broader level, these portfolios do not consistently maintain a positive information ratio over an extended investment horizon. However, disparities in performance emerge, with South African dividend indexes consistently delivering positive ratios over the past decade. Conversely, Emerging Markets and Japanese indexes have experienced substantial declines in their information ratios, despite seemingly consistent performance prior to 2015. Meanwhile, the United States, European Union, and United Kingdom indexes have exhibited unpredictable performance over the sampled period.

When we combine our information ratio findings with drawdown analysis, we observe that advanced economies have experienced fewer drawdowns over the sample period, with the exception of the UK. This could suggest a relatively lower level of systematic risk in these economies. Conversely, South African and Emerging Market drawdowns have been less severe, possibly indicating reduced systematic risk in emerging markets.

In the context of South Africa, focusing on the top 50 companies by market capitalization, we observe a performance pattern similar to our international analysis. Firstly, dividend portfolios do not convincingly deliver superior total returns, as calculated by cumulative returns. However, their value becomes apparent during periods of high volatility and rising interest rate cycles. Moreover, when we consider more traditional proxies for value, such as the Price to Earnings (P/E) ratio, the efficacy of dividend signals diminishes. In other words, portfolios constructed based on P/E ratios perform exceptionally well in our back-test and performance criteria, outperforming the market index 68.8% of the time.

In conclusion, dividend portfolios may not serve as an ideal proxy for value, and investors may benefit more from exploring investment products that provide an income component to their total returns. However, it's worth noting that investor preferences can vary, potentially driving demand for specific dividend portfolio strategies. Based on the evidence, investors constrained by investment policy statements may find value in equity portfolios constructed using Dividend Growth (DG) strategies as these use signals that do a better job of capturing company cash flow management and managerial qualities. Despite their lower hit rate, DG portfolios exhibit lower volatility in achieving returns, making them a practical and profitable means of attaining returns that closely align with the market index.

\newpage
# Appendix {-}

```{r, results='asis'}
p <- readxl::read_xlsx("data/Index Description.xlsx")

p = p %>% tibble::as_tibble()
addtorow          <- list()
addtorow$pos      <- list()
addtorow$pos[[1]] <- c(0)
addtorow$command  <- c(paste("\\hline \n",
                             "\\endhead \n",
                             "\\hline \n",
                             "{\\footnotesize Continued on next page} \n",
                             "\\endfoot \n",
                             "\\endlastfoot \n",sep=""))
table <- xtable(p, caption = "Index Description \\label{tabdes}")
print.xtable(table,
             tabular.environment = "longtable",
             floating = FALSE, # Leave this as is.
             table.placement = 'H', # Leave this as is.
             booktabs = T, # Aesthetics
             include.rownames = FALSE,  # Typically you don't want this in a table.
             add.to.row = addtorow, # For adding the Continued on next page part...
             comment = FALSE,
             caption.placement = 'bottom',  # Where do you want the caption?
             size="\\fontsize{8pt}{9pt}\\selectfont"  # Size of text in table..
)
```


# Dividend Defintions {-}

Bloomberg has two main categories for distributions: Cash Dividends and Stock Dividends. Various kinds of distributions appear under these definitions that do not necessarily only apply to ordinary issued shares (the only security type that we consider in our study). In the next two subsections we define the types of distributions that fall under these categories and in some cases provide additional information. Our sample only comprises of final, interim and regular cash dividends. These dividends are categorized by Bloomberg as Normal Cash. 

### Cash Dividends {-}
- Final: dividend declared for the financial year-end
- Interim (includes 2nd interim, 3rd interim and 4th interim): dividend paid after a reporting period (eg. quarterly or semi-annually)
Special Cash: dividend declared for the financial year-end or interim period over and above the normal dividend
- Regular Cash: a dividend distribution made in cash
- Omitted: A company has elected to skip a scheduled payment
- Discontinued: The discontinuance of dividend payments on an ongoing basis
- Interest on Capital: interest paid on fixed income instruments
- Income: mutual fund dividends, in most cases
- Liquidation: a distribution of a companies assets to shareholders during (interim) or after delisting (final)
- Return of Capital: a non-taxable cash payment to investors from the company that represents a return on invested capital as opposed to a
dividend
- Memorial: a special dividend. For example a company celebrating an anniversary might pay a memorial dividend
- Proceeds from sale of shares: a distribution of cash to shareholders after selling shares. For example this may occur when the company sells
the shares of a shareholder who was not eligible to receive shares in an offering and then distributes the proceeds to shareholders
- Cancelled: the cancellation of a previously declared dividend
- Return Premium: special cash dividend paid from a special reserve
- Preferred Rights Redemption: a company pays a dividend in exchange for previously issued preferred rights

# Stock Dividends {-}

Bonus: also known as a scrip or capitalization issue. Shareholders are given additional stock in proportion to their holdings
- Scrip: a free issue or bonus of shares
- Stock Dividend: portion of a companys retained earnings that are distributed to shareholders in stock. The JSE treats stock dividends as a
capitalization issue
\newpage


# Appendix 2 {-}

# Principal Component Analysis Results {-}

```{r, results='asis'}

```
\newpage
# References {-}

<div id="refs"></div>




