MY_excess_return <-  function(df, index_name, benchmark_name) {
df <-  df %>%
dplyr::rename(Index = index_name, Benchmark = benchmark_name) %>%
select(Date, Index, Benchmark) %>% gather(Vehicle, Value, -Date) %>%
mutate(Return = Value / lag(Value)-1) %>%
mutate(Return = coalesce(Return, 0)) %>%
tbl2xts::tbl_xts(.,cols_to_xts = Return, spread_by = Vehicle) %>%
tbl2xts::xts_tbl() %>%
mutate(ex.ret = Index - Benchmark) %>%
mutate(cum_return = cumprod(1+ex.ret))
# select(Date, cum_return)
# rename(., index_name = cum_return)
df
}
View(b)
View(b)
MY_excess_return <-  function(df, index_name, benchmark_name) {
df <-  df %>%
dplyr::rename(Index = index_name, Benchmark = benchmark_name) %>%
select(Date, Index, Benchmark) %>% gather(Vehicle, Value, -Date) %>%
mutate(Return = Value / lag(Value)-1) %>%
mutate(Return = coalesce(Return, 0)) %>%
tbl2xts::tbl_xts(.,cols_to_xts = Return, spread_by = Vehicle) %>%
tbl2xts::xts_tbl() %>%
mutate(ex.ret = Index - Benchmark) %>%
mutate(cum_return = cumprod(1+ex.ret)) %>%
select(Date, cum_return) %>%
rename(., index_name = cum_return)
df
}
MY_excess_return <-  function(df, index_name, benchmark_name) {
df <-  df %>%
dplyr::rename(Index = index_name, Benchmark = benchmark_name) %>%
select(Date, Index, Benchmark) %>% gather(Vehicle, Value, -Date) %>%
mutate(Return = Value / lag(Value)-1) %>%
mutate(Return = coalesce(Return, 0)) %>%
tbl2xts::tbl_xts(.,cols_to_xts = Return, spread_by = Vehicle) %>%
tbl2xts::xts_tbl() %>%
mutate(ex.ret = Index - Benchmark) %>%
mutate(cum_return = cumprod(1+ex.ret)) %>%
select(date, cum_return) %>%
rename(., index_name = cum_return)
df
}
b <- df %>% MY_excess_return(., "GDUEEGF", "M2EFDY")
MY_excess_return <- function(df, index_name, benchmark_name) {
df <- df %>%
dplyr::rename(Index = {{ index_name }}, Benchmark = {{ benchmark_name }}) %>%
select(Date, Index, Benchmark) %>%
gather(Vehicle, Value, -Date) %>%
mutate(Return = Value / lag(Value) - 1) %>%
mutate(Return = coalesce(Return, 0)) %>%
tbl_xts(., cols_to_xts = Return, spread_by = Vehicle) %>%
xts_tbl() %>%
mutate(ex.ret = Index - Benchmark) %>%
mutate(cum_return = cumprod(1 + ex.ret)) %>%
select(date, cum_return)
colnames(df)[colnames(df) == "index_name"] <- index_name
df
}
b <- df %>% MY_excess_return(., "GDUEEGF", "M2EFDY")
MY_excess_return <- function(df, index_name, benchmark_name) {
df <- df %>%
dplyr::rename(Index = {{ index_name }}, Benchmark = {{ benchmark_name }}) %>%
select(Date, Index, Benchmark) %>%
gather(Vehicle, Value, -Date) %>%
mutate(Return = Value / lag(Value) - 1) %>%
mutate(Return = coalesce(Return, 0)) %>%
tbl_xts(., cols_to_xts = Return, spread_by = Vehicle) %>%
xts_tbl() %>%
mutate(ex.ret = Index - Benchmark) %>%
mutate(cum_return = cumprod(1 + ex.ret)) %>%
select(date, cum_return)
colnames(df)[colnames(df) == "cum_return"] <- index_name
df
}
b <- df %>% MY_excess_return(., "GDUEEGF", "M2EFDY")
MY_excess_return <- function(df, index_name, benchmark_name) {
df <- df %>%
dplyr::rename(Index = {{ index_name }}, Benchmark = {{ benchmark_name }}) %>%
select(Date, Index, Benchmark) %>%
gather(Vehicle, Value, -Date) %>%
mutate(Return = Value / lag(Value) - 1) %>%
mutate(Return = coalesce(Return, 0)) %>%
tbl_xts(., cols_to_xts = Return, spread_by = Vehicle) %>%
xts_tbl() %>%
mutate(ex.ret = Index - Benchmark) %>%
mutate(cum_return = cumprod(1 + ex.ret)) %>%
select(date, cum_return)
colnames(df)[colnames(df) == "cum_return"] <- "index_name"
df
}
b <- df %>% MY_excess_return(., "GDUEEGF", "M2EFDY")
b
b
MY_excess_return <- function(df, index_name, benchmark_name) {
df <- df %>%
dplyr::rename(Index = {{ index_name }}, Benchmark = {{ benchmark_name }}) %>%
select(Date, Index, Benchmark) %>%
gather(Vehicle, Value, -Date) %>%
mutate(Return = Value / lag(Value) - 1) %>%
mutate(Return = coalesce(Return, 0)) %>%
tbl_xts(., cols_to_xts = Return, spread_by = Vehicle) %>%
xts_tbl() %>%
mutate(ex.ret = Index - Benchmark) %>%
mutate(cum_return = cumprod(1 + ex.ret)) %>%
select(date, cum_return)
colnames(df)[colnames(df) == cum_return] <- index_name
df
}
b <- df %>% MY_excess_return(., "GDUEEGF", "M2EFDY")
b
View(b)
MY_excess_return <- function(df, index_name, benchmark_name) {
df <- df %>%
dplyr::rename(Index = {{ index_name }}, Benchmark = {{ benchmark_name }}) %>%
select(Date, Index, Benchmark) %>%
gather(Vehicle, Value, -Date) %>%
mutate(Return = Value / lag(Value) - 1) %>%
mutate(Return = coalesce(Return, 0)) %>%
tbl_xts(., cols_to_xts = Return, spread_by = Vehicle) %>%
xts_tbl() %>%
mutate(ex.ret = Index - Benchmark) %>%
mutate(cum_return = cumprod(1 + ex.ret)) %>%
select(date, cum_return)
df$cum_return <- df$index_name
df
}
b <- df %>% MY_excess_return(., "GDUEEGF", "M2EFDY")
b
View(b)
View(b)
View(b)
View(b)
View(b)
View(b)
View(b)
View(b)
View(b)
View(b)
View(b)
View(b)
View(b)
MY_excess_return <- function(df, index_name, benchmark_name) {
df <- df %>%
dplyr::rename(Index = {{ index_name }}, Benchmark = {{ benchmark_name }}) %>%
select(Date, Index, Benchmark) %>%
gather(Vehicle, Value, -Date) %>%
mutate(Return = Value / lag(Value) - 1) %>%
mutate(Return = coalesce(Return, 0)) %>%
tbl_xts(., cols_to_xts = Return, spread_by = Vehicle) %>%
xts_tbl() %>%
mutate(ex.ret = Index - Benchmark) %>%
mutate(cum_return = cumprod(1 + ex.ret)) %>%
select(date, cum_return)
df$cum_return <- df[[,index_name]]
df
}
b <- df %>% MY_excess_return(., "GDUEEGF", "M2EFDY")
# loadings
pacman::p_load("xts", "tidyverse", "tbl2xts", "PerformanceAnalytics",
"lubridate", "glue")
library(tbl2xts)
library(tidyverse)
library(xts)
source("code/EXCESSRETURN.R")
df <- readxl::read_xlsx
df$Date <- as.Date(df$Date)
b <- df %>% MY_excess_return(., "GDUEEGF", "M2EFDY")
MY_excess_return <- function(df, index_name, benchmark_name) {
df <- df %>%
dplyr::rename(Index = {{ index_name }}, Benchmark = {{ benchmark_name }}) %>%
select(Date, Index, Benchmark) %>%
gather(Vehicle, Value, -Date) %>%
mutate(Return = Value / lag(Value) - 1) %>%
mutate(Return = coalesce(Return, 0)) %>%
tbl_xts(., cols_to_xts = Return, spread_by = Vehicle) %>%
xts_tbl() %>%
mutate(ex.ret = Index - Benchmark) %>%
mutate(cum_return = cumprod(1 + ex.ret)) %>%
select(date, cum_return)
df
}
(., "GDUEEGF", "M2EFDY")
MY_excess_return <- function(df, index_name, benchmark_name) {
df <- df %>%
dplyr::rename(Index = index_name, Benchmark = benchmark_name) %>%
select(Date, Index, Benchmark) %>%
gather(Vehicle, Value, -Date) %>%
mutate(Return = Value / lag(Value) - 1) %>%
mutate(Return = coalesce(Return, 0)) %>%
tbl_xts(., cols_to_xts = Return, spread_by = Vehicle) %>%
xts_tbl() %>%
mutate(ex.ret = Index - Benchmark) %>%
mutate(cum_return = cumprod(1 + ex.ret)) %>%
select(date, cum_return)
df
}
b <- df %>% MY_excess_return(., "GDUEEGF", "M2EFDY")
b
MY_excess_return <- function(df, index_name, benchmark_name) {
df <- df %>%
dplyr::rename(Index = index_name, Benchmark = benchmark_name) %>%
select(Date, Index, Benchmark) %>%
gather(Vehicle, Value, -Date) %>%
mutate(Return = Value / lag(Value) - 1) %>%
mutate(Return = coalesce(Return, 0)) %>%
tbl_xts(., cols_to_xts = Return, spread_by = Vehicle) %>%
xts_tbl() %>%
mutate(ex.ret = Index - Benchmark) %>%
mutate(cum_return = cumprod(1 + ex.ret)) %>%
select(date, cum_return)
df %>%  rename("index_name" = "cum_return")
df
}
b <- df %>% MY_excess_return(., "GDUEEGF", "M2EFDY")
b
MY_excess_return <- function(df, index_name, benchmark_name) {
df <- df %>%
dplyr::rename(Index = index_name, Benchmark = benchmark_name) %>%
select(Date, Index, Benchmark) %>%
gather(Vehicle, Value, -Date) %>%
mutate(Return = Value / lag(Value) - 1) %>%
mutate(Return = coalesce(Return, 0)) %>%
tbl_xts(., cols_to_xts = Return, spread_by = Vehicle) %>%
xts_tbl() %>%
mutate(ex.ret = Index - Benchmark) %>%
mutate(cum_return = cumprod(1 + ex.ret)) %>%
select(date, cum_return)
df %>%  rename("cum_return" = "index_name")
df
}
b <- df %>% MY_excess_return(., "GDUEEGF", "M2EFDY")
MY_excess_return <- function(df, index_name, benchmark_name) {
df <- df %>%
dplyr::rename(Index = index_name, Benchmark = benchmark_name) %>%
select(Date, Index, Benchmark) %>%
gather(Vehicle, Value, -Date) %>%
mutate(Return = Value / lag(Value) - 1) %>%
mutate(Return = coalesce(Return, 0)) %>%
tbl_xts(., cols_to_xts = Return, spread_by = Vehicle) %>%
xts_tbl() %>%
mutate(ex.ret = Index - Benchmark) %>%
mutate(cum_return = cumprod(1 + ex.ret)) %>%
select(date, cum_return)
df %>%  rename(index_name = cum_return)
df
}
b <- df %>% MY_excess_return(., "GDUEEGF", "M2EFDY")
b
MY_excess_return <- function(df, index_name, benchmark_name) {
df <- df %>%
dplyr::rename(Index = index_name, Benchmark = benchmark_name) %>%
select(Date, Index, Benchmark) %>%
gather(Vehicle, Value, -Date) %>%
mutate(Return = Value / lag(Value) - 1) %>%
mutate(Return = coalesce(Return, 0)) %>%
tbl_xts(., cols_to_xts = Return, spread_by = Vehicle) %>%
xts_tbl() %>%
mutate(ex.ret = Index - Benchmark) %>%
mutate(cum_return = cumprod(1 + ex.ret)) %>%
select(date, cum_return)
df %>%  rename("index_name" = cum_return)
df
}
b <- df %>% MY_excess_return(., "GDUEEGF", "M2EFDY")
b
MY_excess_return <- function(df, index_name, benchmark_name) {
df <- df %>%
dplyr::rename(Index = index_name, Benchmark = benchmark_name) %>%
select(Date, Index, Benchmark) %>%
gather(Vehicle, Value, -Date) %>%
mutate(Return = Value / lag(Value) - 1) %>%
mutate(Return = coalesce(Return, 0)) %>%
tbl_xts(., cols_to_xts = Return, spread_by = Vehicle) %>%
xts_tbl() %>%
mutate(ex.ret = Index - Benchmark) %>%
mutate(cum_return = cumprod(1 + ex.ret)) %>%
select(date, cum_return)
colnames(df)[2] ="index_name"
df
}
b <- df %>% MY_excess_return(., "GDUEEGF", "M2EFDY")
b
b <- df %>% MY_excess_return(., GDUEEGF, M2EFDY)
MY_excess_return <- function(df, index_name, benchmark_name) {
df <- df %>%
dplyr::rename(Index = "index_name", Benchmark = "benchmark_name") %>%
select(Date, Index, Benchmark) %>%
gather(Vehicle, Value, -Date) %>%
mutate(Return = Value / lag(Value) - 1) %>%
mutate(Return = coalesce(Return, 0)) %>%
tbl_xts(., cols_to_xts = Return, spread_by = Vehicle) %>%
xts_tbl() %>%
mutate(ex.ret = Index - Benchmark) %>%
mutate(cum_return = cumprod(1 + ex.ret)) %>%
select(date, cum_return)
colnames(df)[2] ="index_name"
df
}
b <- df %>% MY_excess_return(., GDUEEGF, M2EFDY)
MY_excess_return <- function(df, index_name, benchmark_name) {
df <- df %>%
dplyr::rename(Index = "index_name", Benchmark = "benchmark_name") %>%
select(Date, Index, Benchmark) %>%
gather(Vehicle, Value, -Date) %>%
mutate(Return = Value / lag(Value) - 1) %>%
mutate(Return = coalesce(Return, 0)) %>%
tbl_xts(., cols_to_xts = Return, spread_by = Vehicle) %>%
xts_tbl() %>%
mutate(ex.ret = Index - Benchmark) %>%
mutate(cum_return = cumprod(1 + ex.ret)) %>%
select(date, cum_return)
colnames(df)[2] =index_name
df
}
b <- df %>% MY_excess_return(., GDUEEGF, M2EFDY)
MY_excess_return <- function(df, index_name, benchmark_name) {
df <- df %>%
dplyr::rename(Index = index_name, Benchmark = benchmark_name) %>%
select(Date, Index, Benchmark) %>%
gather(Vehicle, Value, -Date) %>%
mutate(Return = Value / lag(Value) - 1) %>%
mutate(Return = coalesce(Return, 0)) %>%
tbl_xts(., cols_to_xts = Return, spread_by = Vehicle) %>%
xts_tbl() %>%
mutate(ex.ret = Index - Benchmark) %>%
mutate(cum_return = cumprod(1 + ex.ret)) %>%
select(date, cum_return)
colnames(df)[2] = index_name
df
}
b <- df %>% MY_excess_return(., GDUEEGF, M2EFDY)
b <- df %>% MY_excess_return(., "GDUEEGF", "M2EFDY")
b
df %>% distinct() %>% names()
b <- df %>% MY_excess_return(., "GDUEEGF", "TJDIVD")
b
tail(b)
View(excess.return)
A <- df %>% MY_excess_return(., "FUDP", "TUKXG") %>% as.list()
A
A <- df %>% MY_excess_return(., "FUDP", "TUKXG") %>% as.list()
B <- df %>% MY_excess_return(., "M2EFDY", "GDUEEGF") %>% as.list()
C <- df %>% MY_excess_return(., "M2EUGDY", "GDDUE15X") %>% as.list()
D <- df %>% MY_excess_return(., "M2GBDY", "GDDUUK") %>% as.list()
E <- df %>% MY_excess_return(., "M2JPDY", "TJDIVD") %>% as.list()
F1 <- df %>% MY_excess_return(., "M2USADVD", "GDDUUS") %>% as.list()
G <- df %>% MY_excess_return(., "M2WDHDVD", "GDDUWI") %>% as.list()
H <- df %>% MY_excess_return(., "SPDAEET", "SPTR350E") %>% as.list()
I <- df %>% MY_excess_return(., "SPDAUDT", "SPXT") %>% as.list()
J <- df %>% MY_excess_return(., "SPJXDAJT", "TPXDDVD") %>% as.list()
K <- df %>% MY_excess_return(., "SPSADAZT", "JALSH") %>% as.list()
L <- df %>% MY_excess_return(., "TJDIVD", "JALSH") %>% as.list()
data_frames <- list(
A = A,
B = B,
C = C,
D = D,
E = E,
F1 = F1,
G = G,
H = H,
I = I,
J = J,
K = K,
L = L
)
# Add a new column indicating the source of each row
data_frames_with_source <- lapply(data_frames, function(df, name) {
df %>%
mutate(Source = name)
}, names(data_frames))
data_frames
L
L <- df %>% MY_excess_return(., "TJDIVD", "JALSH")
L
View(L)
A <- df %>% MY_excess_return(., "FUDP", "TUKXG") %>% left_join(df %>% MY_excess_return(., "M2EFDY", "GDUEEGF"), by=date)
data_frames <- list(A, B, C, D, E, F1, G, H, I, J, K, L)
combined_df <- data_frames[[1]]
for (i in 2:length(data_frames)) {
combined_df <- left_join(combined_df, data_frames[[i]], by = "date")
}
for (i in 2:length(data_frames)) {
combined_df <- left_join(combined_df, data_frames[[i]], by = "Date")
}
data_frames <- data_frame(A, B, C, D, E, F1, G, H, I, J, K, L)
joined_df <- bind_rows(A, B, C, D, E, F1, G, H, I, J, K, L)
joined_df
joined_df <- bind_cols(A, B, C, D, E, F1, G, H, I, J, K, L)
joined_df
joined_df %>% select(date...1, FUDP, M2EFDY, M2EUGDY, M2GBDY, M2JPDY, M2USADVD, M2WDHDVD, SPDAEET, SPDAUDT, SPJXDAJT, SPSADAZT, TJDIVD)
joined_df %>% select(date...1, FUDP, M2EFDY, M2EUGDY, M2GBDY, M2JPDY, M2USADVD, M2WDHDVD, SPDAEET, SPDAUDT, SPJXDAJT, SPSADAZT, TJDIVD) %>% gather(Index , Return , -date...1)
compare <- joined_df %>% select(date...1, FUDP, M2EFDY, M2EUGDY, M2GBDY, M2JPDY, M2USADVD, M2WDHDVD, SPDAEET, SPDAUDT, SPJXDAJT, SPSADAZT, TJDIVD) %>% gather(Index , Return , -date...1)
compare %>%
ggplot( aes(x = date...1, y = Return, color = Index)) +
geom_line() +
labs(x = "Date", y = "Return", color = "Index") +
theme_minimal()
ggplot(plot_data, aes(x = date...1, y = Return, color = Index)) +
geom_line() +
labs(x = "Date", y = "Return", color = "Index") +
theme_minimal() +
facet_wrap(~ Index, scales = "free_y", ncol = 2)
ggplot( aes(x = date...1, y = Return, color = Index)) +
geom_line() +
labs(x = "Date", y = "Return", color = "Index") +
theme_minimal() +
facet_wrap(~ Index, scales = "free_y", ncol = 2)
compare %>% ggplot(aes(x = date...1, y = Return, color = Index)) +
geom_line() +
labs(x = "Date", y = "Return", color = "Index") +
theme_minimal() +
facet_wrap(~ Index, scales = "free_y", ncol = 2)
compare %>% ggplot(aes(x = date...1, y = Return, color = Index)) +
geom_line() +
labs(x = "Date", y = "Return", color = "Index") +
theme_minimal() +
facet_wrap(~ Index, scales = "free_y", ncol = 4)
# loadings
pacman::p_load("xts", "tidyverse", "tbl2xts", "PerformanceAnalytics",
"lubridate", "glue")
library(tbl2xts)
library(tidyverse)
library(xts)
source("code/EXCESSRETURN.R")
df <- readxl::read_xlsx
df$Date <- as.Date
df$Date <- as.Date
df <- readxl::read_xlsx
df$Date <- as.Date
# loadings
pacman::p_load("xts", "tidyverse", "tbl2xts", "PerformanceAnalytics",
"lubridate", "glue")
library(tbl2xts)
library(tidyverse)
library(xts)
source("code/EXCESSRETURN.R")
df <- readxl::read_xlsx
# get all permutatation
A <- df %>% MY_excess_return(., "FUDP", "TUKXG")
# loadings
pacman::p_load("xts", "tidyverse", "tbl2xts", "PerformanceAnalytics",
"lubridate", "glue")
library(tbl2xts)
library(tidyverse)
library(xts)
source("code/EXCESSRETURN.R")
df <- readxl::read_xlsx
# get all permutatation
A <- df %>% MY_excess_return(., "FUDP", "TUKXG")
A <- df %>% MY_excess_return(., "FUDP", "TUKXG")
source("code/EXCESSRETURN.R")
# get all permutatation
A <- df %>% MY_excess_return(., "FUDP", "TUKXG")
pacman::p_load("xts", "tidyverse", "tbl2xts", "PerformanceAnalytics",
"lubridate", "glue")
library(tbl2xts)
library(tidyverse)
library(xts)
source("code/EXCESSRETURN.R")
df <- readxl::read_xlsx
# get all permutatation
A <- df %>% MY_excess_return(., "FUDP", "TUKXG")
# loadings
pacman::p_load("xts", "tidyverse", "tbl2xts", "PerformanceAnalytics",
"lubridate", "glue")
library(tbl2xts)
library(tidyverse)
library(xts)
source("code/EXCESSRETURN.R")
df <- readxl::read_xlsx
# get all permutatation
A <- df %>% MY_excess_return(., "FUDP", "TUKXG")
MY_excess_return <- function(df, index_name, benchmark_name) {
df <- df %>%
dplyr::rename(Index = index_name, Benchmark = benchmark_name) %>%
select(Date, Index, Benchmark) %>%
gather(Vehicle, Value, -Date) %>%
mutate(Return = Value / lag(Value) - 1) %>%
mutate(Return = coalesce(Return, 0)) %>%
tbl_xts(., cols_to_xts = Return, spread_by = Vehicle) %>%
xts_tbl() %>%
mutate(ex.ret = Index - Benchmark) %>%
mutate(cum_return = cumprod(1 + ex.ret)) %>%
select(date, cum_return)
colnames(df)[2] = index_name
df
}
source("code/EXCESSRETURN.R")
df <- readxl::read_xlsx
# get all permutatation
A <- df %>% MY_excess_return(., "FUDP", "TUKXG")
# get all permutatation
A <- df %>% MY_excess_return(., FUDP, TUKXG)
MY_excess_return <- function(df, index_name, benchmark_name) {
df <- df %>%
dplyr::rename(Index = index_name, Benchmark = benchmark_name) %>%
select(Date, Index, Benchmark) %>%
gather(Vehicle, Value, -Date) %>%
mutate(Return = Value / lag(Value) - 1) %>%
mutate(Return = coalesce(Return, 0)) %>%
tbl_xts(., cols_to_xts = Return, spread_by = Vehicle) %>%
xts_tbl() %>%
mutate(ex.ret = Index - Benchmark) %>%
mutate(cum_return = cumprod(1 + ex.ret)) %>%
select(date, cum_return)
colnames(df)[2] = index_name
df
}
A <- df %>% MY_excess_return(., "FUDP", "TUKXG")
